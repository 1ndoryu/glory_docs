---
title: DefaultContentManager
description: "Define y sincroniza contenido por defecto para CPTs desde código"
---

`DefaultContentManager` es una fachada agnóstica que permite declarar contenido por defecto (posts/páginas) desde código y sincronizarlo con la base de datos. La lógica reside en `DefaultContentRegistry` (almacenamiento en memoria) y `DefaultContentSynchronizer` (sincronización real).

## Resumen
- **Para qué sirve**: asegurar que cierto contenido exista y se mantenga según definiciones versionadas.
- **Dónde va**: en el tema (`/App`), por ejemplo `App/Content/defaultContent.php`. Glory sigue siendo agnóstico.

## Cuándo usarlo
- Semillas de contenido inicial (home, políticas, landing demo).
- Contenido de sistema que no debe faltar.

## API básica

```php
<?php
use Glory\Manager\DefaultContentManager;

/**
 * Define contenido por defecto para un tipo.
 * @param string $tipoPost  Slug del CPT (ej. 'page','libro').
 * @param array  $posts     Definiciones (ver estructura abajo).
 * @param string $modo      'none'|'force'|'smart' (def: 'smart').
 * @param bool   $eliminar  Eliminar posts obsoletos (def: false).
 */
DefaultContentManager::define(string $tipoPost, array $posts, string $modo = 'smart', bool $eliminar = false): void;

/** Registra hooks ('init' y detección de ediciones). */
DefaultContentManager::register(): void;
```

### Estructura de cada definición (array $posts)
- **slugDefault**: string requerido y único por CPT.
- **titulo**: título del post.
- **contenido**: HTML seguro.
- **extracto**: string (opcional).
- **estado**: 'publish' (def), 'draft', etc.
- **metaEntrada**: array asociativo de metadatos. Si una clave coincide con una taxonomía del CPT, se asigna como término.
- **imagenDestacadaAsset**: referencia `alias::archivo.ext` o `random::alias`.
- **galeriaAssets**: array de referencias de assets (opcional).

## Ejemplo mínimo (tema)

```php
// App/Content/defaultContent.php
use Glory\Manager\DefaultContentManager;

DefaultContentManager::define('libro', [
    [
        'slugDefault' => 'el-principito',
        'titulo'      => 'El Principito',
        'contenido'   => 'Una novela poética...',
        'imagenDestacadaAsset' => 'elements::libros/principito.jpeg',
    ],
]);
```

## Parámetros y modos
- **modo**: 'none' (no actualiza), 'force' (sobrescribe siempre), 'smart' (actualiza solo si no fue editado manualmente y hay cambios).
- **eliminar**: si `true`, borra entradas gestionadas cuyo `slugDefault` ya no está en código.

## API avanzada

```php
/** Genera posts de ejemplo con slugs y contenido deterministas. */
DefaultContentManager::buildSamplePosts(array $titles, array $paragraphs, array $options = []): array;
```

### Opciones de buildSamplePosts
- **aliasImagenes**: alias de AssetsUtility (def: 'colors').
- **minBytes**: filtro de tamaño mínimo (bytes).

## Modo Dev/Local vs Producción
- La sincronización no corre automáticamente en front. Se ejecuta desde el panel (SyncManager) o CLI.
- Activa `defaultContentManager` y `syncManager` en `App/Config/control.php`.
- Recomendación: usar `smart` en prod; `force` solo en despliegues controlados. Evitar `eliminar` en prod salvo certeza.

## Errores frecuentes
- Falta `slugDefault` o CPT no existe al sincronizar.
- Assets inexistentes en `imagenDestacadaAsset`/`galeriaAssets`.
- Taxonomías declaradas en `metaEntrada` que no existen para el CPT.

## Integración con el tema
- Define el contenido en `App/Content/defaultContent.php` (tema).
- El registro de hooks lo realiza el core si la feature `defaultContentManager` está activa.
