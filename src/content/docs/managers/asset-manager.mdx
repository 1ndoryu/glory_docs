---
title: AssetManager
description: Registro y gestión de scripts y estilos en Glory
---

## Resumen

Gestiona el registro y encolado de scripts y estilos del tema. Permite definir assets puntuales o auto‑descubrir una carpeta completa con un solo llamado.

## Cuándo usarlo
- Cuando el tema necesite registrar CSS/JS propios.
- Cuando quieras auto‑descubrir y versionar archivos por carpeta con un prefijo uniforme.
- No lo uses para lógica del core: el núcleo de Glory debe permanecer agnóstico del tema.

## API

```php
// define(type, handle, ruta, config)
AssetManager::define(
    'script',                 // type: 'script' | 'style'
    'miHandle',               // handle: identificador único sin espacios
    'App/Assets/js/app.js',   // ruta: relativa al tema; detecta .min.* si existe
    [
        'deps'      => ['jquery'],                 // dependencias WP
        'in_footer' => true,                       // solo scripts
        'media'     => 'all',                      // solo estilos
        'area'      => 'frontend',                 // 'frontend'|'admin'|'both'
        'feature'   => 'miFeature',                // requiere feature activa
        'localize'  => [                           // objeto JS inyectado
            'nombreObjeto' => 'misDatos',
            'datos'        => ['ajaxUrl' => admin_url('admin-ajax.php')],
        ],
        'defer'     => true,                       // por defecto true en scripts
        'ver'       => '0.1.1',                    // override de versión del tema
    ]
);

// defineFolder(type, carpeta, config = [], prefijo = '', excluir = [])
AssetManager::defineFolder(
    'style',                   // type
    'App/Assets/css/',         // carpeta relativa al tema
    ['media' => 'all'],        // config aplicada a todos los archivos
    'tema-',                   // prefijo del handle
    ['task.css']               // excluir archivos concretos
);
```

Métodos auxiliares: `AssetManager::setThemeVersion(version)` (cache busting) y `AssetManager::setGlobalDevMode(bool)` (desactiva la caché del auto‑descubrimiento en desarrollo).

Parámetros complejos:
- **localize**: genera una variable global JS con `nombreObjeto` que contiene `datos`. Útil para pasar `ajaxUrl`, nonces u opciones del tema sin escribir inline scripts manuales.

Nota: El registro/encolado se engancha automáticamente a los hooks de WP (no necesitas llamar a `register()` explícitamente).

## Ejemplo mínimo

```php
use Glory\Manager\AssetManager;

AssetManager::defineFolder(
    'script',
    'App/Assets/js/',
    ['deps' => ['jquery'], 'in_footer' => true],
    'tema-'
);
```

## Notas y límites
- Requiere tener activa la feature `assetManager` en `App/Config/control.php`.
- Fuera de modo desarrollo, el auto‑descubrimiento se cachea y prioriza archivos `.min.*` si existen.
- Para datos dinámicos en JS, usa `localize` con `nombreObjeto` y `datos` (se emite vía `wp_localize_script`).

## Modo Dev/Local

- Activación: `App/Config/environment.php` lee `.env` (`DEV` y `LOCAL`). `DEV=true` activa `AssetManager::setGlobalDevMode(true)`. Además, `defineFolder` considera `WP_DEBUG` para decidir si usa caché del auto‑descubrimiento.
- Efectos en desarrollo (DEV o `WP_DEBUG` activos):
  - `defineFolder`: no usa el archivo de caché; re‑explora la carpeta en cada carga.
  - Versionado: si no defines `ver`, se usa `filemtime` del archivo para cache busting.
  - Encolado: se sirven archivos sin `.min.*` (no se fuerza minificados).
- Efectos en producción (DEV=false):
  - `defineFolder`: cachea la lista descubierta en `Glory/cache/glory_assets_*.php` y la reutiliza.
  - Encolado: si existe `.min.js/.min.css`, se usa automáticamente.
  - Versionado: por defecto usa `AssetManager::setThemeVersion(...)` o `ver` explícito.
- Control por asset: en `define(...)` puedes usar `'dev_mode' => true|false` para forzar el modo de versionado por archivo (prioriza sobre el global).
- Limpieza de caché: si cambias archivos en producción, usa la opción de la barra de admin «Borrar Caché de Glory» (SyncManager) para eliminar la caché de auto‑descubrimiento.

## Integración con el tema
- Define tus assets del tema en `App/Config/assets.php` agrupando por carpeta cuando sea posible.
- Usa `AssetManager::setThemeVersion('0.1.1')` en `App/Config/config.php` para controlar el cache busting del tema.

## Recomendaciones de uso
- Ubica los archivos del tema en `App/Assets/js/` y `App/Assets/css/` y usa `defineFolder` con prefijo (p.ej. `tema-`).
- Activa/desactiva librerías del core con `GloryFeatures` (no copies assets del core al tema).
- Prefiere `localize` para pasar datos a JS en lugar de scripts inline.
- Usa `area` para limitar dónde se encolan (admin/frontend) y `feature` para toggles finos.
- Nombra handles consistentes y cortos; evita duplicados.

## Diferencias: assets del tema vs assets de Glory
- Tema (`/App`):
  - Viven en `App/Assets/...`.
  - Se definen en `App/Config/assets.php` con `AssetManager`.
  - Son específicos del proyecto/tema.
- Glory (`/Glory`):
  - Viven en el núcleo de Glory y son agnósticos.
  - Se controlan por features (p.ej. `GloryFeatures::enable('highlight')`).
  - No deben editarse desde el tema; si necesitas cambios, sobreescribe desde el tema con tu propio handle.

## Ejemplo avanzado

```php
use Glory\Manager\AssetManager;

// 1) Registrar un script con feature flag, datos localizados y sólo en frontend
AssetManager::define(
    'script',
    'tema-busqueda',
    'App/Assets/js/busqueda.js',
    [
        'deps'      => ['jquery'],
        'in_footer' => true,
        'area'      => 'frontend',
        'feature'   => 'gloryBusqueda',
        'localize'  => [
            'nombreObjeto' => 'busquedaData',
            'datos'        => [
                'ajaxUrl' => admin_url('admin-ajax.php'),
                'nonce'   => wp_create_nonce('buscar'),
            ],
        ],
        'ver'       => '0.1.1',
    ]
);

// 2) Auto-descubrir CSS del tema con exclusiones y prefijo
AssetManager::defineFolder(
    'style',
    'App/Assets/css/',
    ['media' => 'all'],
    'tema-',
    ['task.css']
);
```

Notas del ejemplo:
- `feature` permite alinear el encolado con toggles de `GloryFeatures`.
- `localize` expone `busquedaData` en `window` con `ajaxUrl` y `nonce`.
- `defineFolder` evita registrar uno a uno y mantiene un prefijo coherente.

## Errores frecuentes (rápido)
- Rutas relativas mal puestas (usa `App/Assets/...`, no `/assets/...`).
- Olvidar activar la feature asociada y el asset no se encola.
- Duplicar `handle` entre archivos (el último pisa al anterior).
- Usar `localize` sin `nombreObjeto` válido.
- Esperar scripts en admin sin ajustar `area: 'admin'` o `'both'`.
- Cambiar archivos en producción y no actualizar `setThemeVersion` (caché).
