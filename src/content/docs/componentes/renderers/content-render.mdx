---
title: ContentRender
description: Renderiza listas de contenido con caché, orden, paginación y plantillas callback
sidebar:
  order: 1
---

import { Aside } from '@astrojs/starlight/components';

## Resumen
Componente agnóstico para listar contenido de WordPress con caché, paginación, orden flexible y plantillas por callback.

## Cuándo usarlo
- Cuando necesitas listar un `postType` con un layout consistente y reutilizable.
- Cuando quieres separar la consulta (datos) del marcado (plantilla por item).
- Cuando requieres caché, orden avanzado o paginación sin recarga.

## Características

- **Caché**: Almacenamiento con invalidación automática al modificar contenido.
- **Paginación**: Controles estándar; estructura lista para AJAX (opcional).
- **Orden**: Fecha, meta, aleatorio con semilla e IDs preferidos.
- **Plantillas**: Callbacks para renderizado personalizado por item.
- **UI agnóstico**: Atributos `data-*` para JS externo.
- **Imágenes**: Optimización opcional vía `ImageUtility`.

Relacionado: ver `introduccion/como-crear-plantillas-content-render.mdx` para crear plantillas.

## API básica

```php
use Glory\Components\ContentRender;

// Forma simple con callback
ContentRender::print('post', [
    'publicacionesPorPagina' => 6,
    'plantillaCallback' => [MiClase::class, 'miPlantilla'],
]);

// Forma con plantilla registrada (recomendada)
ContentRender::print('post', [
    'publicacionesPorPagina' => 6,
    'plantilla' => 'miPlantillaId', // Se resuelve via TemplateRegistry o TemplateManager
]);
```

### Opciones principales

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `plantilla` | string | null | ID de plantilla registrada (alternativa a plantillaCallback) |
| `plantillaCallback` | callable | defaultTemplate | Callback para renderizar cada item |
| `publicacionesPorPagina` | int | 10 | Elementos por página |
| `paginacion` | bool | false | Activar paginación AJAX |
| `orden` | string | 'fecha' | 'fecha', 'random', 'meta' |
| `tiempoCache` | int | HOUR_IN_SECONDS | Segundos de caché |
| `forzarSinCache` | bool | false | Ignorar caché |

## Configuración Completa

### Opciones de Consulta y Caché

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `publicacionesPorPagina` | int | 10 | Elementos por página |
| `claseContenedor` | string | 'glory-content-list' | Clase CSS del contenedor |
| `claseItem` | string | 'glory-content-item' | Clase CSS por item |
| `argumentosConsulta` | array | [] | Args adicionales para WP_Query |
| `orden` | string | 'fecha' | 'fecha', 'random', 'meta' |
| `metaKey` | string\|null | null | Clave meta si orden='meta' |
| `tiempoCache` | int | HOUR_IN_SECONDS | Segundos de caché |

### Opciones UI Agnósticas

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `acciones` | array | [] | Acciones disponibles (ej: ['eliminar']) |
| `submenu` | bool | false | Habilitar submenús |
| `eventoAccion` | string | 'dblclick' | Evento para activar acciones |
| `selectorItem` | string | '[id^="post-"]' | Selector CSS para identificar items |
| `idsPreferidos` | array | [] | IDs que aparecerán primero en el orden |

### Opciones de Layout

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `display_mode` | string | 'flex' | Modo de visualización: 'block', 'flex', 'grid' |
| `gap` | string | '20px' | Espaciado entre items (solo flex/grid) |
| `flex_direction` | string | 'row' | Dirección flex: 'row', 'column' |
| `flex_wrap` | string | 'wrap' | Envolver items: 'nowrap', 'wrap' |
| `justify_content` | string | 'flex-start' | Justificación: 'flex-start', 'center', 'flex-end', 'space-between', 'space-around' |
| `align_items` | string | 'stretch' | Alineación: 'stretch', 'flex-start', 'center', 'flex-end' |
| `grid_columns` | int | 3 | Columnas en modo grid |
| `grid_min_width` | string | '250px' | Ancho mínimo por item en grid |

### Opciones de Imágenes

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `img_show` | bool | true | Mostrar imagen destacada |
| `img_size` | string | 'medium' | Tamaño: 'thumbnail', 'medium', 'large', 'full' |
| `img_aspect_ratio` | string | null | Aspect ratio (ej: '16/9', '4/3', '1/1') |
| `img_object_fit` | string | 'cover' | Ajuste: 'cover', 'contain' |
| `imgOptimize` | bool | true | Usar optimización de imágenes |
| `imgQuality` | int | 60 | Calidad de compresión (1-100) |

### Opciones de Título

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `title_show` | bool | true | Mostrar título |
| `title_font_size` | string | null | Tamaño de fuente (ej: '18px', '1.2rem') |
| `title_color` | string | null | Color del título |
| `title_position` | string | 'top' | Posición: 'top', 'bottom' |
| `title_show_on_hover` | bool | false | Mostrar solo al pasar el mouse |

### Opciones de Interacción

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `interaccion_modo` | string | 'normal' | Modo: 'normal', 'carousel', 'toggle' |

### Filtro por Categorías

| Opción | Tipo | Default | Descripción |
|--------|------|---------|-------------|
| `categoryFilter` | array | `['enabled' => false]` | Configuración del filtro |
| `categoryFilter.enabled` | bool | false | Activar filtro por categorías |
| `categoryFilter.allLabel` | string | 'All' | Etiqueta para el botón "Todos" |

## Parámetros complejos
Breve guía de claves menos obvias:
- **argumentosConsulta**: se fusiona con los args base de `WP_Query`. Ejemplos: `meta_query`, `tax_query`, `post__in`, `paged`. Si pasas `post__in` sin `orderby`, se respeta el orden explícito.
- **orden='random'**: usa `RAND(seed)` estable. Puedes pasar `argumentosConsulta['glory_rand_seed']` para controlar la semilla.
- **idsPreferidos**: reordena resultados priorizando esos IDs al inicio, sin perder el resto.

## Ejemplo mínimo

```php
use Glory\Components\ContentRender;

ContentRender::print('post', [
    'publicacionesPorPagina' => 6,
    'plantilla' => 'miPlantilla',
]);
```

## Ejemplo con layout y filtros

```php
ContentRender::print('portfolio', [
    'publicacionesPorPagina' => 12,
    'plantilla' => 'cardPortfolio',
    'display_mode' => 'grid',
    'grid_columns' => 3,
    'gap' => '24px',
    'img_show' => true,
    'img_aspect_ratio' => '16/9',
    'title_position' => 'bottom',
    'categoryFilter' => [
        'enabled' => true,
        'allLabel' => 'Todos',
    ],
]);
```

## Ejemplo avanzado

```php
// Orden aleatorio estable y priorización de IDs
ContentRender::print('post', [
    'orden' => 'random',
    'argumentosConsulta' => ['glory_rand_seed' => 12345],
    'idsPreferidos' => [15, 23, 8],
    'paginacion' => true,
]);
```

## Métodos principales

### `print(string $postType, array $opciones = []): void`

Renderiza contenido con soporte de caché y paginación.

```php
// Ejemplo básico
ContentRender::print('post');

// Paginación (estructura lista para AJAX)
ContentRender::print('product', [
    'paginacion' => true,
    'publicacionesPorPagina' => 12,
]);
```

### Gestión de Caché

```php
// Limpiar caché de un tipo de post específico
ContentRender::clearCacheForPostType('post');

// Limpiar toda la caché de ContentRender
ContentRender::clearAllContentCaches();

// Inicializar hooks de limpieza automática
ContentRender::initHooks();
```

## Plantillas personalizadas

### Plantilla por Defecto

La plantilla `defaultTemplate` incluye título, imagen destacada y excerpt:

```php
public static function defaultTemplate(\WP_Post $post, string $itemClass): void
{
    ?>
    <div id="post-<?php echo $post->ID; ?>" class="<?php echo esc_attr($itemClass); ?>">
        <a class="glory-cr__link" href="<?php echo esc_url(get_permalink($post)); ?>">
            <div class="glory-cr__stack">
                <h2 class="glory-cr__title"><?php echo esc_html(get_the_title($post)); ?></h2>
                <?php if (has_post_thumbnail($post)): ?>
                    <img class="glory-cr__image" src="<?php echo esc_url(get_the_post_thumbnail_url($post, 'medium')); ?>" alt="<?php echo esc_attr(get_the_title($post)); ?>">
                <?php endif; ?>
            </div>
        </a>
        <div class="entry-content"><?php the_excerpt(); ?></div>
    </div>
    <?php
}
```

### Crear plantilla personalizada

```php
class MiRenderPersonalizado
{
    public static function renderCard(\WP_Post $post, string $itemClass): void
    {
        $indice = ContentRender::getCurrentOption('indiceItem', 0);
        $esPar = $indice % 2 === 0;
        ?>
        <article class="<?php echo esc_attr($itemClass . ($esPar ? ' par' : ' impar')); ?>">
            <header>
                <h3><?php echo esc_html(get_the_title($post)); ?></h3>
                <time><?php echo get_the_date('', $post); ?></time>
            </header>

            <?php if (has_post_thumbnail($post)): ?>
                <div class="featured-image">
                    <?php echo get_the_post_thumbnail($post, 'large'); ?>
                </div>
            <?php endif; ?>

            <div class="content">
                <?php echo apply_filters('the_excerpt', get_the_excerpt($post)); ?>
            </div>

            <footer>
                <a href="<?php echo esc_url(get_permalink($post)); ?>" class="read-more">
                    Leer más
                </a>
            </footer>
        </article>
        <?php
    }
}

// Usar la plantilla personalizada
ContentRender::print('post', [
    'plantillaCallback' => [MiRenderPersonalizado::class, 'renderCard']
]);
```

### Plantilla de contenido completo

Para páginas de detalle o contenido expandido:

```php
ContentRender::print('page', [
    'plantillaCallback' => [ContentRender::class, 'fullContentTemplate'],
    'publicacionesPorPagina' => 1
]);
```

## Integración con JavaScript (opcional)

ContentRender genera automáticamente atributos `data-*` para integración con JavaScript agnóstico:

```html
<div class="glory-content-list"
     data-post-type="post"
     data-content-actions="eliminar"
     data-submenu-enabled="0"
     data-accion-evento="dblclick"
     data-item-selector="[id^='post-']"
     data-template-callback="MiClase::metodo">
    <!-- Items -->
</div>
```

### Paginación con AJAX

Cuando se activa la paginación AJAX, se genera una estructura especial:

```html
<div class="glory-pagination-container"
     data-nonce="..."
     data-post-type="post"
     data-posts-per-page="10"
     data-template-callback="..."
     data-content-target=".glory-content-target"
     data-pagination-target=".glory-pagination-target">
    <div class="glory-content-target">
        <!-- Contenido -->
    </div>
    <div class="glory-pagination-target">
        <!-- Controles de paginación -->
    </div>
</div>
```

## Recomendaciones
- Mantén las plantillas en el tema y reutilízalas.
- Para registrar plantillas y opciones, usa `utilidades/template-registry.mdx`.
- Usa nombres camelCase y clases cortas y claras (`claseContenedor`, `claseItem`).
- Prefiere `plantillaCallback` a lógica inline para escalar.

## Notas y edge cases
- Si hay `post__in` sin `orderby`, se respeta el orden explícito.
- Se aplican filtros internos para evitar duplicados en consultas complejas.
- Con `orden='meta'` recuerda establecer `metaKey`.
- `paginacion: true` imprime estructura y controles listos para manejarse vía JS (opcional).

## Integración con el tema
- Llama `ContentRender::print(...)` desde tus plantillas del tema.
- Define tus callbacks en el tema; evita lógica específica dentro del núcleo.
- Consulta `introduccion/como-crear-plantillas-content-render.mdx` para guías de plantillas.

## Casos de Uso Avanzados

### Filtro por Meta Campos

```php
ContentRender::print('event', [
    'metaKey' => 'event_date',
    'orden' => 'ASC',
    'argumentosConsulta' => [
        'meta_query' => [
            [
                'key' => 'event_date',
                'value' => date('Y-m-d'),
                'compare' => '>='
            ]
        ]
    ]
]);
```

### Contenido Relacionado

```php
$relatedPostIds = get_related_posts_ids(get_the_ID());

ContentRender::print('post', [
    'argumentosConsulta' => [
        'post__in' => $relatedPostIds,
        'orderby' => 'post__in'
    ],
    'idsPreferidos' => $relatedPostIds,
    'publicacionesPorPagina' => 4
]);
```

### Renderizado Condicional

```php
// Solo mostrar si hay resultados
$query = new WP_Query([
    'post_type' => 'product',
    'posts_per_page' => 1
]);

if ($query->have_posts()) {
    ContentRender::print('product', [
        'publicacionesPorPagina' => 8,
        'claseContenedor' => 'featured-products'
    ]);
}
```

## Modo Dev/Local

- **DEV/LOCAL**: Si `WP_DEBUG` es `true`, no se usa caché.
- **Invalidación automática**: `ContentRender::initHooks()` limpia cachés al crear/editar/eliminar/restaurar posts.
- **Claves de caché**: Segmentadas por configuración y página (`paged`).
- **Producción**: Ajusta `tiempoCache` según tus necesidades.

### Optimización de Imágenes

```php
ContentRender::print('post', [
    'imgOptimize' => true,
    'imgQuality' => 80,
    'imgSize' => 'large'
]);
```

### Deduplicación Automática

ContentRender incluye filtros para prevenir duplicados en consultas complejas.

## Errores frecuentes

1) Caché no se actualiza
```php
// Forzar sin caché para depurar
ContentRender::print('post', ['forzarSinCache' => true]);
// Limpiar caché manualmente
ContentRender::clearCacheForPostType('post');
```
2) Paginación no cambia de página
- Asegura `paginacion: true` y que tu JS capture los enlaces de paginación si usas AJAX.
3) Imágenes sin optimizar
- Revisa `ImageUtility` y la configuración (`imgOptimize`, `imgQuality`, `imgSize`).

## API avanzada

```php
use Glory\Components\ContentRender;

// Hooks de invalidación de caché (llamar en setup del tema)
ContentRender::initHooks(): void;

// Limpiar caché por tipo de post o toda la caché
ContentRender::clearCacheForPostType(string $postType): void;
ContentRender::clearAllContentCaches(): void;

// Plantillas utilitarias
ContentRender::defaultTemplate(\WP_Post $post, string $itemClass): void;
ContentRender::fullContentTemplate(\WP_Post $post, string $itemClass): void;

// Compartir datos entre render principal y plantilla
ContentRender::getCurrentOption(string $key, $default = null);
ContentRender::setCurrentOption(string $key, $value): void;
```

## Dependencias

- `WP_Query` — Consultas de WordPress
- `PaginationRenderer` — Controles de paginación
- `ImageUtility` — Optimización de imágenes (opcional)

<Aside type="tip">
Inicializa los hooks de limpieza de caché en el setup del tema:

```php
add_action('after_setup_theme', function() {
    ContentRender::initHooks();
});
```
</Aside>
