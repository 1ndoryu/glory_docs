---
title: FormBuilder
description: Constructor de formularios HTML con validaciÃ³n y envÃ­o AJAX integrado
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

# ğŸ—ï¸ FormBuilder - Constructor de Formularios

`FormBuilder` es un componente de Glory que permite construir formularios HTML complejos sin escribir markup repetitivo. Incluye validaciÃ³n del lado del cliente, envÃ­o AJAX automÃ¡tico y integraciÃ³n perfecta con los handlers del servidor.

## ğŸ¯ CaracterÃ­sticas Principales

- âœ… **GeneraciÃ³n automÃ¡tica de HTML** - No mÃ¡s markup repetitivo
- âœ… **ValidaciÃ³n integrada** - Cliente y servidor
- âœ… **EnvÃ­o AJAX automÃ¡tico** - Sin JavaScript adicional
- âœ… **Manejo de archivos** - Subida nativa de archivos
- âœ… **Campos personalizables** - Estilos y atributos flexibles
- âœ… **IntegraciÃ³n con handlers** - ConexiÃ³n directa con PHP

## ğŸ—ï¸ Arquitectura

FormBuilder consta de tres componentes principales:

1. **FormBuilder (PHP)** - Genera el HTML del formulario
2. **gloryForm.js (JS)** - Maneja validaciÃ³n y envÃ­o
3. **FormHandler (PHP)** - Procesa datos en el servidor

## ğŸš€ Uso BÃ¡sico

### Formulario Simple de Contacto

```php
<?php
use Glory\Components\FormBuilder;

// Inicio del formulario
echo FormBuilder::inicio([
    'atributos' => [
        'id' => 'form-contacto',
        'class' => 'formulario-contacto'
    ]
]);

// Campo de texto
echo FormBuilder::campoTexto([
    'nombre' => 'nombre_completo',
    'label' => 'Nombre Completo',
    'requerido' => true,
    'placeholder' => 'Ingresa tu nombre completo'
]);

// Campo de email
echo FormBuilder::campoEmail([
    'nombre' => 'email',
    'label' => 'Correo ElectrÃ³nico',
    'requerido' => true,
    'placeholder' => 'tu@email.com'
]);

// Campo de textarea
echo FormBuilder::campoTextarea([
    'nombre' => 'mensaje',
    'label' => 'Mensaje',
    'requerido' => true,
    'filas' => 5,
    'placeholder' => 'Escribe tu mensaje aquÃ­...'
]);

// BotÃ³n de envÃ­o
echo FormBuilder::botonEnviar([
    'accion' => 'procesarContacto',
    'texto' => 'Enviar Mensaje',
    'clases' => 'btn btn-primary'
]);

// Fin del formulario
echo FormBuilder::fin();
?>
```

## ğŸ“ Tipos de Campos Disponibles

### Campos de Texto

```php
// Campo de texto bÃ¡sico
echo FormBuilder::campoTexto([
    'nombre' => 'titulo',
    'label' => 'TÃ­tulo',
    'requerido' => true,
    'placeholder' => 'Ingresa un tÃ­tulo',
    'valor' => 'Valor por defecto',
    'maxLength' => 100
]);

// Campo de contraseÃ±a
echo FormBuilder::campoPassword([
    'nombre' => 'password',
    'label' => 'ContraseÃ±a',
    'requerido' => true,
    'minLength' => 8
]);

// Campo de email
echo FormBuilder::campoEmail([
    'nombre' => 'email',
    'label' => 'Email',
    'requerido' => true,
    'placeholder' => 'tu@email.com'
]);

// Campo numÃ©rico
echo FormBuilder::campoNumero([
    'nombre' => 'edad',
    'label' => 'Edad',
    'requerido' => true,
    'min' => 18,
    'max' => 99
]);
```

### Campos de SelecciÃ³n

```php
// Campo select
echo FormBuilder::campoSelect([
    'nombre' => 'categoria',
    'label' => 'CategorÃ­a',
    'opciones' => [
        '' => 'Selecciona una categorÃ­a',
        'tecnologia' => 'TecnologÃ­a',
        'marketing' => 'Marketing',
        'ventas' => 'Ventas'
    ],
    'requerido' => true
]);

// Campo radio buttons
echo FormBuilder::campoRadio([
    'nombre' => 'genero',
    'label' => 'GÃ©nero',
    'opciones' => [
        'masculino' => 'Masculino',
        'femenino' => 'Femenino',
        'otro' => 'Otro'
    ],
    'requerido' => true
]);

// Campo checkboxes mÃºltiple
echo FormBuilder::campoCheckboxMultiple([
    'nombre' => 'intereses',
    'label' => 'Intereses',
    'opciones' => [
        'tecnologia' => 'TecnologÃ­a',
        'deportes' => 'Deportes',
        'musica' => 'MÃºsica',
        'viajes' => 'Viajes'
    ]
]);
```

### Campos Especiales

```php
// Campo textarea
echo FormBuilder::campoTextarea([
    'nombre' => 'descripcion',
    'label' => 'DescripciÃ³n',
    'requerido' => true,
    'filas' => 4,
    'columnas' => 50,
    'placeholder' => 'Describe tu proyecto...'
]);

// Campo checkbox Ãºnico
echo FormBuilder::campoCheckbox([
    'nombre' => 'acepto_terminos',
    'label' => 'Acepto los tÃ©rminos y condiciones',
    'requerido' => true,
    'valor' => '1'
]);

// Campo de archivo
echo FormBuilder::campoArchivo([
    'nombre' => 'archivo_cv',
    'label' => 'Curriculum Vitae',
    'aceptar' => '.pdf,.doc,.docx',
    'multiple' => false,
    'maxSize' => '5MB'
]);

// Campo oculto
echo FormBuilder::campoOculto([
    'nombre' => 'form_id',
    'valor' => 'contacto_2024'
]);
```

## ğŸ¨ PersonalizaciÃ³n y Estilos

### Atributos HTML Personalizados

```php
echo FormBuilder::campoTexto([
    'nombre' => 'telefono',
    'label' => 'TelÃ©fono',
    'atributos' => [
        'data-mask' => '(99) 9999-9999',
        'autocomplete' => 'tel',
        'inputmode' => 'tel'
    ],
    'clases' => 'campo-telefono',
    'estilos' => 'width: 200px;'
]);
```

### Formularios con DiseÃ±o Personalizado

```php
// Formulario con grid layout
echo FormBuilder::inicio([
    'atributos' => ['class' => 'form-grid']
]);

echo '<div class="form-row">';
echo FormBuilder::campoTexto([
    'nombre' => 'nombre',
    'label' => 'Nombre',
    'contenedor' => false // No generar contenedor automÃ¡tico
]);
echo FormBuilder::campoTexto([
    'nombre' => 'apellido',
    'label' => 'Apellido',
    'contenedor' => false
]);
echo '</div>';

echo FormBuilder::campoEmail([
    'nombre' => 'email',
    'label' => 'Email'
]);

echo FormBuilder::fin();
```

## ğŸ”„ IntegraciÃ³n con Handlers

### Crear un Handler Personalizado

```php
<?php
use Glory\Handler\Form\FormHandler;

class ProcesarContactoHandler extends FormHandler {

    public function procesar() {
        // Obtener datos sanitizados
        $nombre = $this->getDato('nombre_completo');
        $email = $this->getDato('email');
        $mensaje = $this->getDato('mensaje');

        // Validar email
        if (!is_email($email)) {
            return $this->error('Email invÃ¡lido');
        }

        // Procesar el formulario
        $this->enviarEmailContacto($nombre, $email, $mensaje);

        // Respuesta de Ã©xito
        return $this->exito('Mensaje enviado correctamente');
    }

    private function enviarEmailContacto($nombre, $email, $mensaje) {
        $asunto = "Nuevo mensaje de contacto de {$nombre}";
        $contenido = "De: {$nombre} ({$email})\n\n{$mensaje}";

        wp_mail(
            get_option('admin_email'),
            $asunto,
            $contenido
        );
    }
}
```

### Handler con Archivos

```php
<?php
class SubirArchivoHandler extends FormHandler {

    public function procesar() {
        // Verificar que hay archivo
        if (empty($_FILES['archivo'])) {
            return $this->error('No se recibiÃ³ ningÃºn archivo');
        }

        $archivo = $_FILES['archivo'];

        // Validar tipo de archivo
        $tiposPermitidos = ['image/jpeg', 'image/png', 'application/pdf'];
        if (!in_array($archivo['type'], $tiposPermitidos)) {
            return $this->error('Tipo de archivo no permitido');
        }

        // Procesar subida
        $resultado = $this->procesarSubidaArchivo($archivo);

        if ($resultado['exito']) {
            return $this->exito('Archivo subido correctamente', [
                'url' => $resultado['url'],
                'id' => $resultado['id']
            ]);
        } else {
            return $this->error('Error al subir archivo: ' . $resultado['error']);
        }
    }

    private function procesarSubidaArchivo($archivo) {
        // LÃ³gica de subida de archivo
        // Retornar array con 'exito', 'url', 'id' o 'error'
    }
}
```

## âš¡ Funcionalidades Avanzadas

### Formularios con Meta Datos

```php
// Formulario para guardar meta datos de usuario
echo FormBuilder::inicio([
    'atributos' => ['data-meta-target' => 'user']
]);

echo FormBuilder::campoTexto([
    'nombre' => 'profesion',
    'label' => 'ProfesiÃ³n',
    'valor' => UserUtility::meta('profesion')
]);

echo FormBuilder::campoTexto([
    'nombre' => 'telefono',
    'label' => 'TelÃ©fono',
    'valor' => UserUtility::meta('telefono')
]);

echo FormBuilder::botonEnviar([
    'accion' => 'guardarMetaUsuario',
    'texto' => 'Guardar Perfil'
]);

echo FormBuilder::fin();
```

### Formularios con ValidaciÃ³n Condicional

```php
echo FormBuilder::inicio([
    'atributos' => ['id' => 'form-registro']
]);

echo FormBuilder::campoTexto([
    'nombre' => 'tipo_usuario',
    'label' => 'Tipo de Usuario',
    'opciones' => [
        'particular' => 'Particular',
        'empresa' => 'Empresa'
    ]
]);

// Campo condicional para empresas
echo FormBuilder::campoTexto([
    'nombre' => 'cif',
    'label' => 'CIF',
    'atributos' => [
        'data-condicion' => 'tipo_usuario',
        'data-valor' => 'empresa'
    ],
    'clases' => 'campo-condicional'
]);

echo FormBuilder::campoTexto([
    'nombre' => 'nombre_empresa',
    'label' => 'Nombre de Empresa',
    'atributos' => [
        'data-condicion' => 'tipo_usuario',
        'data-valor' => 'empresa'
    ],
    'clases' => 'campo-condicional'
]);

echo FormBuilder::botonEnviar([
    'accion' => 'registrarUsuario',
    'texto' => 'Registrarse'
]);

echo FormBuilder::fin();
```

## ğŸ¯ JavaScript y Eventos Personalizados

### Escuchar Eventos del Formulario

```javascript
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('form-contacto');

    // Antes de enviar
    form.addEventListener('gloryForm:beforeSubmit', function(e) {
        console.log('Enviando formulario...');
        // Mostrar spinner de carga
        mostrarSpinner();
    });

    // DespuÃ©s de enviar (Ã©xito)
    form.addEventListener('gloryForm:success', function(e) {
        console.log('Formulario enviado correctamente', e.detail);
        ocultarSpinner();
        mostrarMensajeExito(e.detail.message);
    });

    // Error en envÃ­o
    form.addEventListener('gloryForm:error', function(e) {
        console.log('Error en formulario', e.detail);
        ocultarSpinner();
        mostrarMensajeError(e.detail.message);
    });

    // ValidaciÃ³n fallida
    form.addEventListener('gloryForm:validationError', function(e) {
        console.log('Errores de validaciÃ³n', e.detail.errors);
        resaltarCamposConError(e.detail.errors);
    });
});
```

### Personalizar ValidaciÃ³n

```javascript
// AÃ±adir regla de validaciÃ³n personalizada
gloryForm.addValidationRule('telefono', function(value) {
    const regex = /^\(\d{2}\)\s\d{4}-\d{4}$/;
    return regex.test(value) || 'Formato de telÃ©fono invÃ¡lido';
});

// Usar en campo
echo FormBuilder::campoTexto([
    'nombre' => 'telefono',
    'label' => 'TelÃ©fono',
    'validacion' => 'telefono',
    'atributos' => [
        'data-mask' => '(99) 9999-9999'
    ]
]);
```

## ğŸ›¡ï¸ Seguridad y Mejores PrÃ¡cticas

### ValidaciÃ³n del Lado del Servidor

```php
<?php
class FormHandlerSeguro extends FormHandler {

    public function procesar() {
        // Sanitizar todos los inputs
        $datos = $this->sanitizarInputs();

        // Validar permisos
        if (!$this->usuarioPuedeEnviar()) {
            return $this->error('No tienes permisos para realizar esta acciÃ³n');
        }

        // Validar nonce
        if (!$this->verificarNonce()) {
            return $this->error('SesiÃ³n expirada. Recarga la pÃ¡gina e intenta de nuevo');
        }

        // Validar rate limiting
        if ($this->esExcesoDeEnvios()) {
            return $this->error('Demasiados envÃ­os. Espera unos minutos antes de intentar de nuevo');
        }

        // Procesar formulario
        return $this->procesarFormulario($datos);
    }

    private function sanitizarInputs() {
        return [
            'nombre' => sanitize_text_field($this->getDato('nombre')),
            'email' => sanitize_email($this->getDato('email')),
            'mensaje' => sanitize_textarea_field($this->getDato('mensaje'))
        ];
    }
}
```

### PrevenciÃ³n de Spam

```php
// AÃ±adir campo honeypot
echo FormBuilder::campoOculto([
    'nombre' => 'website', // Nombre comÃºn para bots
    'atributos' => ['style' => 'display: none;']
]);

// Validar en handler
if (!empty($this->getDato('website'))) {
    return $this->error('DetecciÃ³n de spam');
}
```

## ğŸ” DepuraciÃ³n y Testing

### Modo Debug

```php
// Habilitar debug en desarrollo
if (WP_DEBUG) {
    echo FormBuilder::inicio([
        'debug' => true, // Muestra informaciÃ³n de debug
        'atributos' => ['id' => 'form-debug']
    ]);
}
```

### Testing de Handlers

```php
<?php
// tests/Handlers/ProcesarContactoHandlerTest.php
class ProcesarContactoHandlerTest extends \PHPUnit\Framework\TestCase {

    public function testProcesamientoExitoso() {
        $handler = new ProcesarContactoHandler();

        // Simular POST data
        $_POST = [
            'nombre_completo' => 'Juan PÃ©rez',
            'email' => 'juan@example.com',
            'mensaje' => 'Mensaje de prueba'
        ];

        $resultado = $handler->procesar();

        $this->assertTrue($resultado['success']);
        $this->assertEquals('Mensaje enviado correctamente', $resultado['message']);
    }

    public function testValidacionEmailInvalido() {
        $handler = new ProcesarContactoHandler();

        $_POST = [
            'nombre_completo' => 'Juan PÃ©rez',
            'email' => 'email-invalido',
            'mensaje' => 'Mensaje de prueba'
        ];

        $resultado = $handler->procesar();

        $this->assertFalse($resultado['success']);
        $this->assertEquals('Email invÃ¡lido', $resultado['message']);
    }
}
```

Â¡FormBuilder hace que crear formularios complejos sea tan simple como declarar campos! La integraciÃ³n automÃ¡tica con validaciÃ³n, AJAX y handlers del servidor elimina la necesidad de escribir JavaScript repetitivo y mejora la seguridad de tu aplicaciÃ³n.
