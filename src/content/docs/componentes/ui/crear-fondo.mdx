---
title: Sistema de Fondos Modales
description: Gestor centralizado de fondos oscuros para modales y overlays con contador de referencias m√∫ltiple
---

import { Card, CardGrid } from '@astrojs/starlight/components';

# Sistema de Fondos Modales (`crearfondo.js`)

El sistema de fondos modales proporciona un gestor centralizado para crear y controlar fondos oscuros que aparecen detr√°s de modales, men√∫s desplegables y otros overlays. Utiliza un sistema de contador de referencias que permite m√∫ltiples componentes compartir el mismo fondo sin conflictos.

## üöÄ Inicio R√°pido

```javascript
// Mostrar fondo modal
mostrarFondo();

// El fondo aparece autom√°ticamente
// Se bloquea el scroll del body

// Ocultar fondo modal
ocultarFondo();

// El fondo se oculta si no hay otras referencias activas
```

```html
<!-- El fondo se crea autom√°ticamente en el DOM -->
<div id="fondoModalGlobal" style="display: none;">
    <!-- Fondo oscuro con z-index alto -->
</div>
```

## üìã Funcionalidades

### Gesti√≥n Centralizada de Fondos
Sistema √∫nico que maneja un fondo modal global compartido por todos los componentes que lo necesiten.

```javascript
// M√∫ltiples componentes pueden usar el mismo fondo
function abrirModal() {
    mostrarFondo(); // Contador: 1
    // Mostrar modal
}

function abrirMenu() {
    mostrarFondo(); // Contador: 2
    // Mostrar men√∫
}

// Al cerrar cualquiera, el fondo permanece si hay otros activos
function cerrarModal() {
    ocultarFondo(); // Contador: 1 (fondo sigue visible)
}

function cerrarMenu() {
    ocultarFondo(); // Contador: 0 (fondo se oculta)
}
```

### Control de Scroll
Autom√°ticamente bloquea y restaura el scroll del body cuando el fondo est√° activo.

```css
/* Cuando el fondo est√° activo */
body.noScroll {
    overflow: hidden;
}
```

### Sistema de Eventos
Emite eventos personalizados para que los componentes puedan reaccionar al clic en el fondo.

```javascript
// Escuchar clics en el fondo
document.addEventListener('gloryFondo:click', function() {
    // Cerrar modales, men√∫s, etc.
    cerrarMiModal();
    cerrarMiMenu();
});
```

## üé® Caracter√≠sticas Visuales

### Estilos del Fondo
- **Color**: `rgba(0, 0, 0, 0.65)` (negro semi-transparente)
- **Posicionamiento**: `fixed` cubriendo toda la pantalla
- **z-index**: `999` (alto para estar sobre la mayor√≠a del contenido)
- **Cursor**: `pointer` para indicar interactividad

### Estados del Fondo
- **Oculto**: `display: none` cuando contador = 0
- **Visible**: `display: block` cuando contador > 0
- **Transici√≥n**: Sin animaciones (cambio instant√°neo)

### Estructura HTML Generada

```html
<!-- Fondo modal global (creado autom√°ticamente) -->
<div id="fondoModalGlobal"
     style="
       position: fixed;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       background-color: rgba(0, 0, 0, 0.65);
       z-index: 999;
       display: none;
       cursor: pointer;
     ">
</div>
```

## üîß Configuraci√≥n Avanzada

### Variables Globales

```javascript
// Referencia al elemento del fondo (null inicialmente)
window.fondoElemento = null;

// Contador de referencias activas
window.fondoContador = 0;
```

### Personalizaci√≥n de Estilos
Aunque el script aplica estilos inline, puedes sobrescribirlos con CSS:

```css
#fondoModalGlobal {
    background-color: rgba(255, 0, 0, 0.5) !important; /* Fondo rojo */
    transition: opacity 0.3s ease; /* A√±adir transici√≥n */
}

#fondoModalGlobal.mostrar {
    opacity: 1;
}

#fondoModalGlobal.ocultar {
    opacity: 0;
}
```

## üìù API T√©cnica

### Funciones Principales

#### `mostrarFondo()`
Incrementa el contador de referencias y muestra el fondo si es necesario.

```javascript
window.mostrarFondo = function() {
    // Asegura que el fondo existe
    // Incrementa contador
    // Muestra fondo si contador > 0
};
```

#### `ocultarFondo()`
Disminuye el contador de referencias y oculta el fondo si llega a cero.

```javascript
window.ocultarFondo = function() {
    // Emite evento 'gloryFondo:click'
    // Decrementa contador
    // Oculta fondo si contador <= 0
};
```

### Funciones Internas

#### `asegurarExistenciaFondo()`
Crea el elemento del fondo si no existe, aplicando estilos y eventos.

#### `mostrarFondoSiNecesario() / ocultarFondoSiNecesario()`
Controlan la visibilidad basado en el contador de referencias.

### Eventos

#### `gloryFondo:click`
Evento personalizado emitido cuando se hace clic en el fondo.

```javascript
document.addEventListener('gloryFondo:click', function(event) {
    // Los componentes deben cerrar sus overlays
    miModal.cerrar();
    miMenu.cerrar();
});
```

## üéØ Casos de Uso

### Modales Tradicionales
```javascript
function abrirModalConfirmacion() {
    mostrarFondo();

    // Crear y mostrar modal
    const modal = crearModalConfirmacion();
    document.body.appendChild(modal);

    // Configurar cierre
    document.addEventListener('gloryFondo:click', cerrarModalUnaVez);

    function cerrarModalUnaVez() {
        modal.remove();
        ocultarFondo();
        document.removeEventListener('gloryFondo:click', cerrarModalUnaVez);
    }
}
```

### Men√∫s Desplegables
```javascript
class MenuDesplegable {
    abrir() {
        mostrarFondo();
        this.elemento.style.display = 'block';
    }

    cerrar() {
        this.elemento.style.display = 'none';
        ocultarFondo();
    }
}

// Inicializaci√≥n autom√°tica
document.addEventListener('gloryFondo:click', function() {
    // Cerrar todos los men√∫s abiertos
    document.querySelectorAll('.menu-abierto').forEach(menu => {
        menu.classList.remove('menu-abierto');
    });
    ocultarFondo();
});
```

### Sistema de Notificaciones
```javascript
function mostrarNotificacionImportante() {
    mostrarFondo();

    // Crear notificaci√≥n modal
    const notif = document.createElement('div');
    notif.className = 'notificacion-modal';
    notif.innerHTML = `
        <div class="notif-contenido">
            <h3>¬°Atenci√≥n!</h3>
            <p>Mensaje importante</p>
            <button onclick="ocultarFondo()">Entendido</button>
        </div>
    `;

    document.body.appendChild(notif);
}
```

### Sidebars y Panels
```javascript
const sidebar = {
    toggle() {
        const isOpen = this.elemento.classList.contains('abierto');

        if (isOpen) {
            this.cerrar();
        } else {
            this.abrir();
        }
    },

    abrir() {
        mostrarFondo();
        this.elemento.classList.add('abierto');
    },

    cerrar() {
        this.elemento.classList.remove('abierto');
        ocultarFondo();
    }
};
```

## üîÑ Compatibilidad

- ‚úÖ **Compartible**: M√∫ltiples componentes pueden usar el mismo fondo
- ‚úÖ **Thread-safe**: Sistema de contador evita conflictos de referencias
- ‚úÖ **Event-driven**: Comunicaci√≥n desacoplada mediante eventos
- ‚úÖ **Performance**: Elemento √∫nico reutilizado, no crea m√∫ltiples fondos
- ‚úÖ **Responsive**: Funciona en todos los tama√±os de pantalla
- ‚úÖ **Accesibilidad**: Soporte b√°sico para navegaci√≥n por teclado

## üêõ Soluci√≥n de Problemas

### Problemas Comunes

1. **Fondo no aparece**: Verificar que `mostrarFondo()` se llame antes de mostrar el overlay
2. **Fondo no se oculta**: Asegurar que `ocultarFondo()` se llame por cada `mostrarFondo()`
3. **Scroll no se bloquea**: Revisar que no haya CSS que sobrescriba `body.noScroll`
4. **M√∫ltiples fondos**: Solo debe existir un elemento con `id="fondoModalGlobal"`

### Debug
```javascript
// Verificar estado del sistema
console.log('Fondo elemento:', window.fondoElemento);
console.log('Contador actual:', window.fondoContador);
console.log('Fondo visible:', window.fondoElemento?.style.display === 'block');

// Reset manual (solo para debug)
window.fondoContador = 0;
window.ocultarFondo();
```

### Verificaci√≥n de Eventos
```javascript
// Monitorear eventos del fondo
document.addEventListener('gloryFondo:click', function() {
    console.log('Fondo clickeado - cerrando overlays');
});

// Verificar creaci√≥n del elemento
const checkFondo = () => {
    const fondo = document.getElementById('fondoModalGlobal');
    console.log('Fondo existe:', !!fondo);
    console.log('Fondo visible:', fondo?.style.display === 'block');
};
```

### Casos Edge
```javascript
// Si el script se recarga m√∫ltiples veces
if (typeof window.mostrarFondo === 'function') {
    console.log('Sistema de fondo ya inicializado');
}

// Verificar integridad
const validarSistema = () => {
    const fondo = document.getElementById('fondoModalGlobal');
    const contador = window.fondoContador || 0;

    if (fondo && contador > 0 && fondo.style.display === 'none') {
        console.warn('Inconsistencia: contador > 0 pero fondo oculto');
    }

    if (!fondo && contador > 0) {
        console.error('Error cr√≠tico: contador > 0 pero no hay elemento fondo');
    }
};
```

