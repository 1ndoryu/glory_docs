---
title: Layout Masonry Row Major
description: Sistema de organizaci√≥n autom√°tica de elementos en columnas estilo muro de ladrillos con posicionamiento absoluto
---

import { Card, CardGrid } from '@astrojs/starlight/components';

# Layout Masonry Row Major (`masonryRowMajor.js`)

El sistema Masonry Row Major proporciona un layout din√°mico que organiza autom√°ticamente los elementos en columnas estilo muro de ladrillos, calculando posiciones absolutas para crear un efecto visual de altura variable. Es completamente agn√≥stico y se adapta autom√°ticamente a cambios de contenido y tama√±o de ventana.

## üöÄ Inicio R√°pido

```html
<!-- Contenedor con elementos a organizar -->
<div id="mi-masonry-container" style="position: relative;">
    <div class="seccionComponente">Elemento 1 - altura variable</div>
    <div class="seccionComponente">Elemento 2 - contenido diferente</div>
    <div class="seccionComponente">Elemento 3 - m√°s texto aqu√≠</div>
    <div class="seccionComponente">Elemento 4 - imagen incluida</div>
</div>
```

```javascript
// Inicializar masonry manualmente
const masonry = Glory.inicializarMasonryRowMajor('#mi-masonry-container', 3);

// Recalcular cuando sea necesario
Glory.recalcularMasonryRowMajor();
```

```css
/* Estilos CSS recomendados */
#masonry-container {
    position: relative;
    width: 100%;
    /* gap definido en CSS */
    gap: 16px;
}

/* Clase aplicada autom√°ticamente */
.masonry-js .seccionComponente {
    position: absolute;
    /* width calculado din√°micamente */
    /* transform calculado din√°micamente */
}
```

## üìã Funcionalidades

### Layout Autom√°tico por Filas
Organiza elementos en orden de fila mayoritaria, distribuy√©ndolos en columnas para minimizar la altura total.

```javascript
// Elementos se colocan en orden:
// Fila 1: Elemento 1, Elemento 2, Elemento 3
// Fila 2: Elemento 4, Elemento 5, Elemento 6
// Cada elemento se posiciona en la columna con menor altura actual
```

### Detecci√≥n Autom√°tica de Columnas
Analiza el CSS `grid-template-columns` para determinar el n√∫mero de columnas autom√°ticamente.

```css
/* CSS Grid define las columnas */
.masonry-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 columnas */
    gap: 20px;
}

/* JavaScript detecta autom√°ticamente 4 columnas */
```

### Rec√°lculo Din√°mico
Se adapta autom√°ticamente a cambios en el DOM, redimensionamiento de ventana y carga de im√°genes.

```javascript
// Eventos que activan rec√°lculo autom√°tico:
// - Cambios en el DOM (MutationObserver)
// - Redimensionamiento de ventana
// - Carga de im√°genes
// - Evento personalizado 'glory:seccionesActualizadas'
```

### Gesti√≥n de Elementos Ocultos
Solo considera elementos visibles en el layout, ignorando aquellos con `display: none` o `visibility: hidden`.

```html
<div class="seccionComponente oculto">Este elemento se ignora</div>
<div class="seccionComponente" style="display: none;">Este tambi√©n</div>
<div class="seccionComponente">Este s√≠ se incluye</div>
```

## üé® Caracter√≠sticas Visuales

### Algoritmo de Posicionamiento
- **Row Major**: Elementos se colocan fila por fila
- **Balanceo**: Cada elemento va a la columna con menor altura actual
- **Absoluto**: Posicionamiento `absolute` con `transform: translate()`

### C√°lculos Autom√°ticos
- **Ancho de columnas**: `(contenedor - gaps) / n√∫mero_columnas`
- **Posici√≥n X**: `columna_index * (ancho_columna + gap)`
- **Posici√≥n Y**: `altura_acumulada_columna`
- **Altura contenedor**: `m√°xima_altura_columnas`

### Transiciones y Animaciones
```css
/* Para animaciones suaves al recargar */
.masonry-js .seccionComponente {
    transition: transform 0.3s ease;
}

/* Evitar durante el c√°lculo inicial */
.masonry-js.calculating .seccionComponente {
    transition: none;
}
```

### Estructura HTML Resultante

```html
<div id="masonry-container" class="masonry-js" style="position: relative; height: 450px;">
    <div class="seccionComponente"
         style="position: absolute; width: 200px; transform: translate(0px, 0px);">
        Contenido 1
    </div>

    <div class="seccionComponente"
         style="position: absolute; width: 200px; transform: translate(216px, 50px);">
        Contenido 2 - m√°s alto
    </div>

    <div class="seccionComponente"
         style="position: absolute; width: 200px; transform: translate(432px, 0px);">
        Contenido 3
    </div>

    <!-- M√°s elementos posicionados autom√°ticamente -->
</div>
```

## üîß Configuraci√≥n Avanzada

### Inicializaci√≥n Manual

#### Par√°metros de `inicializarMasonryRowMajor`
```javascript
const masonry = Glory.inicializarMasonryRowMajor(selector, columnas);

// selector: string - Selector CSS del contenedor
// columnas: number - N√∫mero de columnas (opcional, se detecta autom√°ticamente)
```

#### Ejemplos de Inicializaci√≥n
```javascript
// Con detecci√≥n autom√°tica de columnas
const masonry1 = Glory.inicializarMasonryRowMajor('.galeria');

// Con n√∫mero fijo de columnas
const masonry2 = Glory.inicializarMasonryRowMajor('#productos', 4);

// Para contenedor espec√≠fico
const masonry3 = Glory.inicializarMasonryRowMajor('[data-masonry="true"]', 3);
```

### M√©todos Disponibles

#### `Glory.recalcularMasonryRowMajor()`
Fuerza un rec√°lculo inmediato del layout.

```javascript
// Despu√©s de a√±adir elementos din√°micamente
contenedor.appendChild(nuevoElemento);
Glory.recalcularMasonryRowMajor();

// Despu√©s de cambiar contenido
elemento.innerHTML = 'Nuevo contenido';
Glory.recalcularMasonryRowMajor();
```

#### `desconectar()`
Desactiva el observer y limpia event listeners.

```javascript
const masonry = Glory.inicializarMasonryRowMajor('#container');
// ... uso ...
masonry.desconectar(); // Limpiar recursos
```

### Selectores y Clases

#### Selectores de Elementos
- **Contenedor**: Cualquier selector v√°lido (`#id`, `.clase`, `[atributo]`)
- **Elementos**: `.seccionComponente` (configurable internamente)

#### Clases CSS Aplicadas
- **`.masonry-js`**: Aplicada al contenedor durante inicializaci√≥n
- **Posicionamiento**: `position: absolute` en cada elemento
- **Dimensiones**: `width` calculada din√°micamente

### Configuraci√≥n CSS Recomendada

```css
.masonry-container {
    position: relative;
    width: 100%;
    /* Definir gap para c√°lculos */
    gap: 16px;
    /* Opcional: definir columnas base */
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
}

.masonry-container .seccionComponente {
    /* Estilos base de elementos */
    margin-bottom: 0; /* Evitar m√°rgenes que interfieran */
    box-sizing: border-box;
}

/* Animaciones opcionales */
.masonry-js .seccionComponente {
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.masonry-js.updating .seccionComponente {
    opacity: 0.7;
}
```

## üìù API T√©cnica

### Funciones Internas

#### `detectarColumnasDesdeCSS(elemento)`
Analiza `grid-template-columns` para determinar n√∫mero de columnas.

```javascript
function detectarColumnasDesdeCSS(el) {
    const gridCols = getComputedStyle(el).getPropertyValue('grid-template-columns');
    return gridCols.split(' ').length || 2;
}
```

#### `esVisible(elemento)`
Determina si un elemento es visible en el layout.

```javascript
function esVisible(el) {
    const cs = getComputedStyle(el);
    return cs.display !== 'none' &&
           cs.visibility !== 'hidden' &&
           el.offsetParent !== null;
}
```

#### `layout()`
Funci√≥n principal que calcula y aplica posiciones.

```javascript
function layout() {
    // 1. Obtener elementos visibles
    // 2. Calcular dimensiones de columnas
    // 3. Distribuir elementos por altura m√≠nima
    // 4. Aplicar transformaciones CSS
    // 5. Ajustar altura del contenedor
}
```

### Eventos y Observers

#### MutationObserver
Monitorea cambios en el DOM para rec√°lculos autom√°ticos.

```javascript
const observer = new MutationObserver(function() {
    clearTimeout(container._masonryMutate);
    container._masonryMutate = setTimeout(layout, 80);
});
```

#### Event Listeners
- **`load`**: Layout inicial cuando la p√°gina carga
- **`resize`**: Rec√°lculo al cambiar tama√±o de ventana
- **`glory:seccionesActualizadas`**: Evento personalizado para actualizaciones

### Optimizaciones de Performance

#### Debouncing
- **MutationObserver**: 80ms de delay
- **Resize**: 120ms de delay
- **Im√°genes**: Layout inmediato tras carga

#### C√°lculos Eficientes
- **Un solo loop**: Recorre elementos una vez por layout
- **Cache de alturas**: Mantiene alturas acumuladas por columna
- **Transform vs position**: Usa `transform: translate()` para mejor performance

## üéØ Casos de Uso

### Galer√≠a de Im√°genes
```html
<div id="galeria-masonry" class="galeria-container">
    <div class="seccionComponente imagen-item">
        <img src="foto1.jpg" alt="Foto 1">
        <div class="caption">Descripci√≥n de la foto 1</div>
    </div>

    <div class="seccionComponente imagen-item">
        <img src="foto2.jpg" alt="Foto 2">
        <div class="caption">Foto m√°s alta que las dem√°s</div>
    </div>

    <!-- M√°s im√°genes con alturas variables -->
</div>
```

```css
.galeria-container {
    position: relative;
    gap: 15px;
    padding: 20px;
}

.imagen-item {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.imagen-item img {
    width: 100%;
    height: auto;
    display: block;
}
```

```javascript
// Inicializar galer√≠a
document.addEventListener('DOMContentLoaded', function() {
    Glory.inicializarMasonryRowMajor('#galeria-masonry', 3);
});
```

### Grid de Tarjetas de Producto
```html
<section id="productos-masonry" class="productos-grid">
    <article class="seccionComponente producto-card">
        <img src="producto1.jpg" alt="Producto 1">
        <h3>Producto B√°sico</h3>
        <p>Descripci√≥n corta</p>
        <span class="precio">$29.99</span>
    </article>

    <article class="seccionComponente producto-card">
        <img src="producto2.jpg" alt="Producto 2">
        <h3>Producto Premium</h3>
        <p>Descripci√≥n m√°s larga con m√°s detalles sobre las caracter√≠sticas del producto</p>
        <span class="precio">$49.99</span>
    </article>

    <!-- M√°s productos -->
</section>
```

```javascript
// Con auto-detecci√≥n de columnas
const productosMasonry = Glory.inicializarMasonryRowMajor('#productos-masonry');

// A√±adir productos din√°micamente
function a√±adirProducto(productoHTML) {
    const contenedor = document.querySelector('#productos-masonry');
    contenedor.insertAdjacentHTML('beforeend', productoHTML);
    Glory.recalcularMasonryRowMajor();
}
```

### Blog Posts con Contenido Variable
```html
<div id="blog-masonry" class="blog-posts">
    <div class="seccionComponente post-card">
        <h2>T√≠tulo Corto</h2>
        <p>Extracto breve del post...</p>
    </div>

    <div class="seccionComponente post-card featured">
        <h2>T√≠tulo M√°s Largo Que Requiere M√°s Espacio</h2>
        <p>Extracto mucho m√°s largo que incluye m√°s contenido y detalles sobre el tema tratado en el art√≠culo...</p>
        <img src="featured-image.jpg" alt="Imagen destacada">
    </div>

    <!-- M√°s posts -->
</div>
```

```javascript
// Inicializaci√≥n con columnas responsive
function initBlogMasonry() {
    const columnas = window.innerWidth > 1200 ? 4 :
                    window.innerWidth > 768 ? 3 :
                    window.innerWidth > 480 ? 2 : 1;

    Glory.inicializarMasonryRowMajor('#blog-masonry', columnas);
}

// Reinicializar en resize
let resizeTimeout;
window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(initBlogMasonry, 250);
});
```

### Portfolio de Proyectos
```html
<div id="portfolio-masonry" class="portfolio-grid">
    <div class="seccionComponente project-item">
        <div class="project-media">
            <img src="project1.jpg" alt="Proyecto 1">
        </div>
        <div class="project-info">
            <h3>Proyecto Web</h3>
            <p>Desarrollo de sitio web responsive</p>
            <a href="/proyecto1">Ver proyecto</a>
        </div>
    </div>

    <div class="seccionComponente project-item video-project">
        <div class="project-media">
            <video src="demo1.mp4" poster="poster1.jpg"></video>
        </div>
        <div class="project-info">
            <h3>Aplicaci√≥n M√≥vil</h3>
            <p>Desarrollo de app iOS y Android con contenido multimedia extenso</p>
            <a href="/proyecto2">Ver proyecto</a>
        </div>
    </div>
</div>
```

```javascript
// Portfolio con elementos multimedia
document.addEventListener('DOMContentLoaded', function() {
    const portfolio = Glory.inicializarMasonryRowMajor('#portfolio-masonry', 3);

    // Manejar carga de videos
    document.querySelectorAll('video').forEach(video => {
        video.addEventListener('loadeddata', Glory.recalcularMasonryRowMajor);
    });
});
```

## üîÑ Compatibilidad

- ‚úÖ **Agn√≥stico**: No depende de frameworks espec√≠ficos
- ‚úÖ **Responsive**: Se adapta autom√°ticamente al tama√±o de ventana
- ‚úÖ **Performance**: C√°lculos optimizados y debounced
- ‚úÖ **CSS Grid**: Detecta autom√°ticamente configuraci√≥n de columnas
- ‚úÖ **Im√°genes**: Espera carga completa antes de calcular
- ‚úÖ **Din√°mico**: Maneja adici√≥n/eliminaci√≥n de elementos
- ‚úÖ **Event-driven**: Integraci√≥n con eventos personalizados
- ‚úÖ **Limpieza**: M√©todo desconectar para liberar recursos

## üêõ Soluci√≥n de Problemas

### Problemas Comunes

1. **Elementos se superponen**: Verificar que el contenedor tenga `position: relative`
2. **Alturas incorrectas**: Asegurar que im√°genes tengan `display: block` o est√©n cargadas
3. **No responsive**: Verificar que el CSS permita rec√°lculos en resize
4. **Performance issues**: Reducir n√∫mero de columnas o aumentar debouncing

### Debug
```javascript
// Verificar inicializaci√≥n
console.log('Masonry disponible:', typeof Glory.inicializarMasonryRowMajor);
console.log('Instancia activa:', Glory._masonryInstance);

// Inspeccionar contenedor
const container = document.querySelector('.masonry-js');
console.log('Contenedor encontrado:', !!container);
console.log('Altura calculada:', container?.style.height);
console.log('Elementos:', container?.querySelectorAll('.seccionComponente').length);

// Verificar c√°lculos
function debugLayout() {
    const items = container.querySelectorAll('.seccionComponente');
    const columnas = detectarColumnasDesdeCSS(container);
    console.log('Columnas detectadas:', columnas);
    console.log('Elementos a layout:', items.length);

    items.forEach((item, index) => {
        const rect = item.getBoundingClientRect();
        console.log(`Elemento ${index}:`, {
            width: rect.width,
            height: rect.height,
            transform: item.style.transform
        });
    });
}
```

### Troubleshooting de Performance
```javascript
// Monitorear rec√°lculos
let calculos = 0;
const originalRecalcular = Glory.recalcularMasonryRowMajor;
Glory.recalcularMasonryRowMajor = function() {
    calculos++;
    console.log('Rec√°lculo #', calculos, new Date().toISOString());
    return originalRecalcular.apply(this, arguments);
};

// Verificar observers activos
function verificarObservers() {
    const containers = document.querySelectorAll('.masonry-js');
    containers.forEach(container => {
        console.log('Contenedor:', container.id || container.className);
        console.log('Observer activo:', !!container._masonryObserver);
        console.log('Timeouts activos:', {
            mutate: !!container._masonryMutate,
            resize: !!container._masonryResize
        });
    });
}
```

### Reset y Re-inicializaci√≥n
```javascript
// Limpiar completamente
function resetMasonry() {
    // Desconectar observers existentes
    if (Glory._masonryInstance && Glory._masonryInstance.desconectar) {
        Glory._masonryInstance.desconectar();
    }

    // Limpiar estilos aplicados
    document.querySelectorAll('.masonry-js .seccionComponente').forEach(item => {
        item.style.position = '';
        item.style.width = '';
        item.style.transform = '';
    });

    document.querySelectorAll('.masonry-js').forEach(container => {
        container.style.height = '';
        container.classList.remove('masonry-js');
    });

    // Resetear variables globales
    delete Glory._masonryInstance;
}

// Re-inicializar
function reinicializarMasonry() {
    resetMasonry();
    // Re-inicializar seg√∫n sea necesario
    Glory.inicializarMasonryRowMajor('#mi-container', 3);
}
```

















