---
title: TemplateRegistry
description: Sistema de registro global para plantillas de renderizado agnósticas
sidebar:
  label: TemplateRegistry
---

import { Steps } from '@astrojs/starlight/components';

# TemplateRegistry

El `TemplateRegistry` es un sistema agnóstico para registrar y gestionar plantillas de renderizado de contenido. Permite que los temas registren funciones de renderizado reutilizables que pueden aplicarse a diferentes tipos de contenido.

## Conceptos básicos

- **Agnóstico**: Funciona independientemente del tema o plugin
- **Reutilizable**: Plantillas registradas pueden usarse en múltiples contextos
- **Filtrable**: Soporte para filtrar plantillas por tipo de post
- **Extensible**: Sistema de "supports" para funcionalidades adicionales

## Registro de plantillas

### Método `register()`

```php
use Glory\Utility\TemplateRegistry;

// Registrar una plantilla básica
TemplateRegistry::register(
    'tarjeta_simple',           // ID único
    'Tarjeta Simple',           // Etiqueta visible
    function($post, $itemClass) {
        echo '<div class="' . esc_attr($itemClass) . '">';
        echo '<h3>' . get_the_title($post) . '</h3>';
        echo '<p>' . get_the_excerpt($post) . '</p>';
        echo '</div>';
    },
    ['post', 'page'],           // Post types aplicables
    ['thumbnail', 'excerpt']    // Funcionalidades soportadas
);
```

### Parámetros del registro

- **`$id`**: Identificador único de la plantilla
- **`$label`**: Nombre visible en interfaces
- **`$callable`**: Función de renderizado
- **`$appliesTo`**: Array de post types (vacío = todos)
- **`$supports`**: Array de funcionalidades soportadas

## Función de renderizado

La función callable recibe dos parámetros estándar:

```php
function($post, $itemClass) {
    // $post: Objeto WP_Post
    // $itemClass: Clase CSS para el contenedor

    echo '<article class="' . esc_attr($itemClass) . '">';

    // Contenido personalizado aquí
    if (has_post_thumbnail($post)) {
        echo get_the_post_thumbnail($post, 'medium');
    }

    echo '<h2>' . get_the_title($post) . '</h2>';
    echo '<div class="content">' . apply_filters('the_content', get_the_content($post)) . '</div>';

    echo '</article>';
}
```

## Uso en componentes

### Obtener opciones para select

```php
use Glory\Utility\TemplateRegistry;

// Todas las plantillas disponibles
$todasLasPlantillas = TemplateRegistry::options();

// Solo plantillas para 'producto' post type
$plantillasProducto = TemplateRegistry::options('producto');
```

### Renderizar contenido usando plantilla

```php
use Glory\Utility\TemplateRegistry;

// Obtener la función de renderizado
$plantilla = TemplateRegistry::get('tarjeta_simple');

if ($plantilla) {
    // Renderizar cada post con la plantilla
    while (have_posts()) {
        the_post();
        $plantilla(get_post(), 'post-item');
    }
}
```

## Ejemplo completo de implementación

### 1. Registro de plantillas en functions.php

```php
<?php
// functions.php del tema

use Glory\Utility\TemplateRegistry;
use Glory\Utility\ImageUtility;

function registrar_plantillas_tema() {
    // Plantilla para tarjetas de blog
    TemplateRegistry::register(
        'tarjeta_blog',
        'Tarjeta de Blog',
        function($post, $itemClass) {
            echo '<article class="' . esc_attr($itemClass) . ' blog-card">';
            echo '<div class="blog-image">';
            echo ImageUtility::optimizar($post, 'medium_large');
            echo '</div>';
            echo '<div class="blog-content">';
            echo '<h3><a href="' . get_permalink($post) . '">' . get_the_title($post) . '</a></h3>';
            echo '<p class="meta">Por ' . get_the_author() . ' el ' . get_the_date() . '</p>';
            echo '<p class="excerpt">' . get_the_excerpt($post) . '</p>';
            echo '</div>';
            echo '</article>';
        },
        ['post'],
        ['thumbnail', 'excerpt', 'author', 'date']
    );

    // Plantilla para productos
    TemplateRegistry::register(
        'tarjeta_producto',
        'Tarjeta de Producto',
        function($post, $itemClass) {
            $precio = get_post_meta($post->ID, 'precio', true);

            echo '<div class="' . esc_attr($itemClass) . ' product-card">';
            echo '<div class="product-image">';
            echo ImageUtility::optimizar($post, 'medium');
            echo '</div>';
            echo '<div class="product-info">';
            echo '<h4>' . get_the_title($post) . '</h4>';
            if ($precio) {
                echo '<p class="price">$' . number_format($precio, 0, ',', '.') . '</p>';
            }
            echo '<a href="' . get_permalink($post) . '" class="btn">Ver producto</a>';
            echo '</div>';
            echo '</div>';
        },
        ['producto'],
        ['thumbnail', 'custom_fields']
    );

    // Plantilla genérica para cualquier contenido
    TemplateRegistry::register(
        'contenido_simple',
        'Contenido Simple',
        function($post, $itemClass) {
            echo '<div class="' . esc_attr($itemClass) . ' content-wrapper">';
            echo '<h2>' . get_the_title($post) . '</h2>';
            echo '<div class="content">' . apply_filters('the_content', get_the_content($post)) . '</div>';
            echo '</div>';
        },
        [], // Aplica a todos los post types
        ['content']
    );
}
add_action('init', 'registrar_plantillas_tema');
?>
```

### 2. Uso en un componente personalizado

```php
<?php
// En un componente o template personalizado

use Glory\Utility\TemplateRegistry;

class MiComponenteRenderer
{
    public static function render($posts, $plantillaId = 'tarjeta_blog')
    {
        $plantilla = TemplateRegistry::get($plantillaId);

        if (!$plantilla) {
            return '<p>Plantilla no encontrada</p>';
        }

        $output = '<div class="posts-grid">';

        foreach ($posts as $post) {
            $output .= '<div class="grid-item">';
            ob_start();
            $plantilla($post, 'post-template');
            $output .= ob_get_clean();
            $output .= '</div>';
        }

        $output .= '</div>';

        return $output;
    }
}

// Uso en template
$posts = get_posts(['posts_per_page' => 6]);
echo MiComponenteRenderer::render($posts, 'tarjeta_blog');
?>
```

### 3. Creación de selector en opciones del tema

```php
<?php
// En un metabox o panel de opciones

use Glory\Utility\TemplateRegistry;

function crear_selector_plantilla($postType = null)
{
    $plantillas = TemplateRegistry::options($postType);

    echo '<select name="plantilla_seleccionada" id="plantilla_selector">';
    echo '<option value="">Seleccionar plantilla...</option>';

    foreach ($plantillas as $id => $label) {
        $selected = (get_post_meta(get_the_ID(), 'plantilla_personalizada', true) === $id) ? 'selected' : '';
        echo '<option value="' . esc_attr($id) . '" ' . $selected . '>' . esc_html($label) . '</option>';
    }

    echo '</select>';
}

// En el metabox
function agregar_metabox_plantilla()
{
    add_meta_box(
        'plantilla_selector',
        'Seleccionar Plantilla',
        function() {
            crear_selector_plantilla(get_post_type());
        },
        ['post', 'page', 'producto'],
        'side'
    );
}
add_action('add_meta_boxes', 'agregar_metabox_plantilla');
?>
```

## Verificación de soporte

```php
use Glory\Utility\TemplateRegistry;

// Verificar si una plantilla soporta thumbnails
$soporteThumbnail = TemplateRegistry::supports('tarjeta_blog');

// Verificar post types aplicables
$postTypes = TemplateRegistry::appliesTo('tarjeta_producto');
```

## Mejores prácticas

### 1. Nombres descriptivos
```php
// ✅ Bueno
TemplateRegistry::register('tarjeta_blog_sidebar', 'Tarjeta Blog Sidebar', ...);

// ❌ Evitar
TemplateRegistry::register('temp1', 'Template 1', ...);
```

### 2. Validación de parámetros
```php
function($post, $itemClass) {
    // Validar que $post sea WP_Post
    if (!($post instanceof WP_Post)) {
        return;
    }

    // Escapar clases CSS
    $itemClass = esc_attr($itemClass);
}
```

### 3. Soporte consistente
```php
// Definir claramente qué soporta cada plantilla
$supports = [
    'thumbnail',    // Usa imagen destacada
    'excerpt',      // Muestra extracto
    'author',       // Muestra autor
    'date',         // Muestra fecha
    'custom_fields' // Usa campos personalizados
];
```

### 4. Post types específicos
```php
// Para contenido específico
TemplateRegistry::register('evento_card', 'Tarjeta Evento',
    $callback,
    ['evento'], // Solo para post type 'evento'
    ['thumbnail', 'date', 'custom_fields']
);
```

## Casos de uso avanzados

### Sistema de plantillas condicionales

```php
<?php
function render_plantilla_condicional($post)
{
    // Lógica para elegir plantilla basada en contenido
    if (has_post_thumbnail($post) && has_excerpt($post)) {
        $plantillaId = 'tarjeta_completa';
    } elseif (has_post_thumbnail($post)) {
        $plantillaId = 'tarjeta_con_imagen';
    } else {
        $plantillaId = 'tarjeta_simple';
    }

    $plantilla = TemplateRegistry::get($plantillaId);

    if ($plantilla) {
        $plantilla($post, 'post-adaptive');
    }
}
?>
```

### Integración con builders

```php
<?php
// Para usar con page builders
function shortcode_plantilla_personalizada($atts)
{
    $atts = shortcode_atts([
        'plantilla' => 'contenido_simple',
        'post_id' => get_the_ID(),
        'clase' => 'shortcode-content'
    ], $atts);

    $post = get_post($atts['post_id']);
    $plantilla = TemplateRegistry::get($atts['plantilla']);

    if (!$post || !$plantilla) {
        return '';
    }

    ob_start();
    $plantilla($post, $atts['clase']);
    return ob_get_clean();
}
add_shortcode('plantilla', 'shortcode_plantilla_personalizada');
?>
```

## Consideraciones importantes

- Las plantillas deben ser agnósticas del tema
- Siempre escapar output para seguridad
- Considerar rendimiento en plantillas complejas
- Documentar claramente los parámetros de cada plantilla
- Usar post types específicos cuando sea posible
