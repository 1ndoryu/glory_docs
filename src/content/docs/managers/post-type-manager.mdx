---
title: PostTypeManager
description: "Definir y registrar CPTs (Custom Post Types) desde cdigo"
---

`PostTypeManager` ofrece una API declarativa para crear CPTs con validacin, etiquetas automticas en espaol y metadatos por defecto.

## Resumen
- **Para qu sirve**: definir CPTs versionables con defaults sensatos.
- **Dnde va**: en el tema (`/App`), por ejemplo `App/Content/postType.php`.

## API bsica

```php
<?php
use Glory\Manager\PostTypeManager;

PostTypeManager::define(
    string $slug,
    array $args,
    ?string $singular = null,
    ?string $plural   = null,
    array $metaDefault = []
): void;

/** Engancha 'init' para registrar los CPTs definidos. */
PostTypeManager::register(): void;

/** Registra todos los CPTs definidos (callback de 'init'). */
PostTypeManager::procesarTiposEntrada(): void;

/** Vuelve a generar reglas de reescritura si cambiaste CPTs. */
PostTypeManager::limpiarReglasReescritura(): void;
```

### Reglas para `$slug`
- Solo `[a-z0-9_]`, longitud  20.
- No puede ser reservado: `post`, `page`, `attachment`, `revision`, `nav_menu_item`, `custom_css`, `customize_changeset`, `oembed_cache`, `user_request`, `wp_block`, `action`, `author`, `order`, `theme`.

### `$args` (extracto)
- Valores por defecto inteligentes: `public: true`, `supports: ['title','editor','thumbnail']` si no defines `supports` y proporcionas `singular/plural`.
- Si pasas `$metaDefault`, se aade `custom-fields` a `supports` si hiciera falta.

### `$singular`/`$plural`
- Si ambos existen y no defines `labels`, se generan etiquetas completas en espaol (dominio `glory`).

### `$metaDefault`
- Metadatos que se aaden automticamente al crear una nueva entrada del CPT (no en updates).

## Ejemplo mnimo

```php
use Glory\Manager\PostTypeManager;

PostTypeManager::define(
  'libro',
  [
    'public' => true,
    'has_archive' => true,
    'menu_icon' => 'dashicons-book',
    'show_in_rest' => true,
  ],
  'Libro',
  'Libros'
);
```

## Metadatos por defecto
- Enganche automtico al `save_post_{slug}` para entradas nuevas.
- Usa `add_post_meta($unique=true)`; no sobrescribe si ya existe.

```php
PostTypeManager::define(
  'evento',
  [ 'public' => true ],
  'Evento',
  'Eventos',
  [ 'estado' => 'activo', 'capacidad_maxima' => 50 ]
);
```

## Integracin con DefaultContentManager

```php
use Glory\Manager\DefaultContentManager;

DefaultContentManager::define('libro', [
  [
    'slugDefault' => 'el-principito',
    'titulo' => 'El Principito',
    'contenido' => '...'
  ]
]);
```

## Inicializacin desde el tema
- Define tus CPTs en `App/Content/postType.php`.
- El core registra los managers si las features estn activas en `App/Config/control.php`.
- Si cambias slugs/reescrituras, ejecuta `PostTypeManager::limpiarReglasReescritura()` una vez (por ejemplo, en activacin del tema/plugin).

## Errores frecuentes
- Slug invlido o reservado.
- `supports` no es array.
- Esperar que `$metaDefault` actualice entradas existentes (solo aplica en nuevas).