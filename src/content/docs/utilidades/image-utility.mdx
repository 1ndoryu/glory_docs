---
title: ImageUtility
description: Utilidad para optimización y renderizado de imágenes con soporte CDN
sidebar:
  label: ImageUtility
---

import { Steps } from '@astrojs/starlight/components';

# ImageUtility

La utilidad `ImageUtility` proporciona métodos para optimizar y renderizar imágenes en WordPress, con soporte integrado para Jetpack Photon CDN y configuración automática de atributos de accesibilidad.

## Características principales

- **Optimización automática**: Reduce calidad y tamaño de imágenes para mejorar rendimiento
- **Soporte CDN**: Integración con Jetpack Photon para entrega optimizada
- **Atributos de accesibilidad**: Incluye `alt`, `loading="lazy"`, `width` y `height`
- **Modo desarrollo**: Desactiva optimizaciones en entorno local

## Uso básico

### Método `optimizar()`

```php
use Glory\Utility\ImageUtility;

// Obtener imagen optimizada para un post
$imagenHtml = ImageUtility::optimizar(get_post(), 'medium_large', 60, 'all');

// En un loop de posts
while (have_posts()) {
    the_post();
    echo ImageUtility::optimizar(get_the_ID(), 'large', 70, 'info');
}
```

### Parámetros del método `optimizar()`

- **`$post`**: Objeto `WP_Post` o ID del post
- **`$size`**: Tamaño de imagen WordPress (default: 'medium_large')
- **`$quality`**: Calidad de compresión (0-100, default: 60)
- **`$strip`**: Información EXIF a remover ('all', 'info', 'none', default: 'all')

### Ejemplo completo en template

```php
<?php
// En functions.php o archivo del tema
use Glory\Utility\ImageUtility;

// Dentro del loop
if (have_posts()) {
    while (have_posts()) {
        the_post();

        // Imagen optimizada con configuración personalizada
        $imagenOptimizada = ImageUtility::optimizar(
            get_the_ID(),
            'large',      // Tamaño
            70,          // Calidad
            'info'       // Conservar metadatos básicos
        );

        echo '<article class="post-card">';
        echo '<div class="post-thumbnail">' . $imagenOptimizada . '</div>';
        echo '<h2>' . get_the_title() . '</h2>';
        echo '<div class="post-excerpt">' . get_the_excerpt() . '</div>';
        echo '</article>';
    }
}
?>
```

## Método `jetpack_photon_url()`

Para URLs personalizadas que no sean thumbnails de posts:

```php
use Glory\Utility\ImageUtility;

// Optimizar URL de imagen personalizada
$urlOriginal = 'https://example.com/imagen.jpg';
$urlOptimizada = ImageUtility::jetpack_photon_url($urlOriginal, [
    'quality' => 70,
    'strip'   => 'info',
    'resize'  => '800,600'
]);

echo '<img src="' . esc_url($urlOptimizada) . '" alt="Imagen optimizada" />';
```

## Configuración por entorno

La utilidad detecta automáticamente si está en modo desarrollo:

```php
// En wp-config.php
define('LOCAL', true); // Desactiva optimizaciones CDN
```

## Mejores prácticas

### 1. Elegir calidad apropiada
```php
// Alta calidad para hero images
ImageUtility::optimizar($post, 'full', 85, 'info');

// Calidad media para thumbnails
ImageUtility::optimizar($post, 'medium', 60, 'all');
```

### 2. Usar tamaños apropiados
```php
// Para grids de contenido
ImageUtility::optimizar($post, 'medium_large');

// Para banners principales
ImageUtility::optimizar($post, 'large');
```

### 3. Considerar accesibilidad
```php
// El método automáticamente incluye:
// - Atributo alt del título del post
// - loading="lazy" para mejor rendimiento
// - width/height para evitar CLS (Cumulative Layout Shift)
```

## Casos de uso comunes

### Galería de imágenes optimizada
```php
<?php
$galeria = get_post_meta(get_the_ID(), 'galeria_imagenes', true);
if ($galeria) {
    echo '<div class="galeria-optimizada">';
    foreach ($galeria as $imagen_id) {
        $imagenHtml = ImageUtility::optimizar($imagen_id, 'medium', 65, 'all');
        echo '<div class="galeria-item">' . $imagenHtml . '</div>';
    }
    echo '</div>';
}
?>
```

### Avatar de usuario optimizado
```php
<?php
$user_id = get_current_user_id();
$user_avatar = get_user_meta($user_id, 'avatar_personalizado', true);

if ($user_avatar) {
    $avatar_optimizado = ImageUtility::jetpack_photon_url($user_avatar, [
        'quality' => 75,
        'resize'  => '150,150'
    ]);

    echo '<img src="' . esc_url($avatar_optimizado) . '" class="user-avatar" />';
}
?>
```

## Consideraciones de rendimiento

- Las optimizaciones CDN solo se aplican en producción
- En desarrollo local, se devuelven URLs originales
- El método incluye validaciones para posts sin thumbnail
- Manejo automático de errores para imágenes faltantes
