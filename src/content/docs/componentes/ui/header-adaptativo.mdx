---
title: Header Adaptativo
description: Sistema inteligente de adaptaci√≥n de headers con contraste autom√°tico y men√∫ m√≥vil responsive
---

import { Card, CardGrid } from '@astrojs/starlight/components';

# Header Adaptativo (`adaptiveHeader.js`)

Sistema avanzado que adapta autom√°ticamente el contraste del header basado en el contenido detr√°s de √©l, adem√°s de proporcionar funcionalidad completa de men√∫ m√≥vil con animaciones GSAP.

## üöÄ Inicio R√°pido

```html
<!-- Estructura HTML requerida -->
<header class="siteMenuW">
    <div class="siteMenuLogo">
        <a href="/">
            <img src="logo.png" alt="Logo">
        </a>
    </div>
    <nav class="siteMenuNav">
        <div class="navTitle">Men√∫</div>
        <ul class="menu">
            <li><a href="/">Inicio</a></li>
            <li class="menu-item-has-children">
                <a href="#">Servicios</a>
                <ul class="sub-menu">
                    <li><a href="/servicio1">Servicio 1</a></li>
                    <li><a href="/servicio2">Servicio 2</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <button class="burger">‚ò∞</button>
</header>

<div class="background"></div>
```

```javascript
// Se inicializa autom√°ticamente en DOMContentLoaded y gloryRecarga
// No requiere configuraci√≥n manual adicional
```

## üìã Funcionalidades

### Sistema de Contraste Autom√°tico
- **An√°lisis de luminancia**: Mide el brillo del contenido detr√°s del header
- **Adaptaci√≥n inteligente**: Cambia colores seg√∫n umbral de contraste
- **Elementos afectados**: Logo, texto de navegaci√≥n, √≠conos
- **Performance optimizada**: Usa `requestAnimationFrame` para suavidad

### Men√∫ M√≥vil Completo
- **Animaciones GSAP**: Transiciones suaves y profesionales
- **Toggle de submen√∫s**: Expansi√≥n/colapso con tap
- **Escape handling**: Cierre con tecla Escape
- **Background overlay**: Fondo oscuro durante men√∫ abierto
- **Responsive**: Solo activo en pantallas < 1000px

## üé® Estructura HTML Detallada

### Header Principal
```html
<header class="siteMenuW">
    <!-- Logo adaptable -->
    <div class="siteMenuLogo">
        <a href="/">
            <img src="logo.png" alt="Logo">
            <!-- O texto si no hay imagen -->
            <!-- <span>Mi Sitio</span> -->
        </a>
    </div>

    <!-- Navegaci√≥n principal -->
    <nav class="siteMenuNav">
        <div class="navTitle">Men√∫ Principal</div>
        <ul class="menu">
            <li><a href="/">Inicio</a></li>
            <li><a href="/about">Nosotros</a></li>
            <li class="menu-item-has-children">
                <a href="#">Servicios</a>
                <ul class="sub-menu">
                    <li><a href="/servicio1">Servicio 1</a></li>
                    <li><a href="/servicio2">Servicio 2</a></li>
                </ul>
            </li>
            <li><a href="/contacto">Contacto</a></li>
        </ul>
    </nav>

    <!-- Bot√≥n hamburguesa -->
    <button class="burger" aria-label="Abrir men√∫">
        <span></span>
        <span></span>
        <span></span>
    </button>
</header>
```

### Elementos de Overlay
```html
<!-- Fondo oscuro para men√∫ m√≥vil -->
<div class="background"></div>
```

## üîß Configuraci√≥n y Selectores

### Selectores Principales
```javascript
const headerSelector = '.siteMenuW';          // Contenedor principal
const classToToggle = 'has-dark-background';  // Clase para contraste oscuro
const LUMINANCE_THRESHOLD = 140;             // Umbral de luminancia (0-255)
```

### Elementos Analizados
- **Texto de navegaci√≥n**: `.siteMenuNav a`
- **Logo**: `.siteMenuLogo a`
- **Im√°genes del logo**: `.siteMenuLogo img`
- **SVGs del logo**: `.siteMenuLogo svg`

## üìù API T√©cnica

### Funciones Principales

#### `gloryAdaptiveHeader()`
Inicializa el sistema de adaptaci√≥n del header.

```javascript
// Se ejecuta autom√°ticamente
// Verificaci√≥n de inicializaci√≥n m√∫ltiple
if (header.dataset.adaptiveHeaderInitialized) return;
```

#### `gloryMenu()`
Inicializa la funcionalidad del men√∫ m√≥vil.

```javascript
// Se ejecuta autom√°ticamente en DOMContentLoaded y load
// Previene m√∫ltiples inicializaciones
if (header.dataset.menuInitialized) return;
```

### Sistema de Luminancia

#### `getLuminance(r, g, b)`
Calcula la luminancia percibida de un color RGB.

```javascript
// F√≥rmula est√°ndar de luminancia
// (r * 299 + g * 587 + b * 114) / 1000
function getLuminance(r, g, b) {
    return (r * 299 + g * 587 + b * 114) / 1000;
}
```

#### `getBackgroundColorAtPoint(x, y)`
Obtiene el color de fondo en una coordenada espec√≠fica.

```javascript
// Usa elementFromPoint para an√°lisis preciso
// Ignora el header mismo para an√°lisis correcto
function getBackgroundColorAtPoint(x, y) {
    // Implementaci√≥n que evita interferencias del header
}
```

## üéØ L√≥gica de Adaptaci√≥n

### Umbral de Contraste
```javascript
const LUMINANCE_THRESHOLD = 140; // Ajustable seg√∫n necesidades

// Si luminancia promedio < 140 ‚Üí fondo oscuro detectado
// Se activa clase 'has-dark-background' y filtros de inversi√≥n
```

### Adaptaciones Aplicadas

#### Para Fondos Oscuros
```css
/* Clase a√±adida autom√°ticamente */
.has-dark-background {
    /* Estilos para header sobre fondo oscuro */
}

/* Filtros aplicados a elementos del logo */
.siteMenuLogo img {
    filter: brightness(0) invert(1); /* Blanco */
}

.siteMenuLogo svg {
    filter: invert(1); /* Inversi√≥n de colores */
}

.siteMenuLogo a {
    color: #FFFFFF; /* Texto blanco si es texto */
}
```

#### Para Fondos Claros
```css
/* Filtros removidos autom√°ticamente */
.siteMenuLogo img {
    filter: none;
}

.siteMenuLogo svg {
    filter: none;
}

.siteMenuLogo a {
    color: ''; /* Color original */
}
```

## üì± Funcionalidad M√≥vil

### Animaciones GSAP
- **Entrada**: `yPercent: 0, autoAlpha: 1` con `expo.inOut`
- **Salida**: `yPercent: -100, autoAlpha: 0` con `expo.inOut`
- **Stagger**: Elementos aparecen con delay progresivo

### Estados del Men√∫
```javascript
let isMenuOpen = false; // Estado global

// Clases aplicadas:
// - .open en header
// - .menu-open en body
```

### Comportamiento de Submen√∫s
```javascript
// En m√≥vil: tap en item padre togglea submen√∫
// Evita navegaci√≥n a la URL del padre
// Solo un submen√∫ abierto a la vez
```

## üîÑ Eventos y Disparadores

### Eventos de Inicializaci√≥n
```javascript
// M√∫ltiples puntos de entrada para compatibilidad
document.addEventListener('DOMContentLoaded', init);
window.addEventListener('load', init);
document.addEventListener('gloryRecarga', init);
```

### Eventos de Interacci√≥n
```javascript
// Click en burger
burger.addEventListener('click', toggleMenu);

// Click en background
background.addEventListener('click', closeMenu);

// Tecla Escape
window.addEventListener('keyup', (e) => {
    if (e.key === 'Escape') closeMenu();
});
```

### Eventos de Adaptaci√≥n
```javascript
// Scroll y resize con throttling
window.addEventListener('scroll', onScrollOrResize, {passive: true});
window.addEventListener('resize', onScrollOrResize, {passive: true});

// MutationObserver para cambios en contenido
observer.observe(mainContent, {childList: true, subtree: true});
```

## üé® Personalizaci√≥n CSS

### Estilos Base del Header
```css
.siteMenuW {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    transition: all 0.3s ease;
}

/* Estado normal */
.siteMenuW:not(.has-dark-background) {
    background: rgba(255, 255, 255, 0.95);
    color: #333;
}

/* Estado sobre fondo oscuro */
.siteMenuW.has-dark-background {
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    backdrop-filter: blur(10px);
}
```

### Estilos del Men√∫ M√≥vil
```css
/* Burger button */
.burger {
    display: none; /* Mostrar solo en m√≥vil */
    background: none;
    border: none;
    cursor: pointer;
}

@media (max-width: 999px) {
    .burger {
        display: block;
    }

    .siteMenuNav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(20px);
    }
}

/* Background overlay */
.background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.background.active {
    opacity: 1;
    visibility: visible;
}
```

### Animaciones Personalizadas
```css
/* Submen√∫s m√≥viles */
.menu-item-has-children.open > .sub-menu {
    max-height: 500px;
    opacity: 1;
    transform: translateY(0);
}

.menu-item-has-children > .sub-menu {
    max-height: 0;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.3s ease;
}
```

## üîß Configuraci√≥n Avanzada

### Ajuste del Umbral
```javascript
// Modificar el umbral seg√∫n el dise√±o
const LUMINANCE_THRESHOLD = 160; // M√°s sensible a fondos claros
// o
const LUMINANCE_THRESHOLD = 120; // M√°s sensible a fondos oscuros
```

### Selectores Personalizados
```javascript
// Para temas personalizados
const headerSelector = '.mi-header-personalizado';
const textElementsSelector = '.mi-nav a, .mi-logo';
```

### Performance Tuning
```javascript
// Ajustar frecuencia de an√°lisis
const ANALYSIS_INTERVAL = 100; // ms entre an√°lisis

// Modo debug
const DEBUG_MODE = true; // Log detallado de an√°lisis
```

## üéØ Casos de Uso

### Header Transparente
```html
<header class="siteMenuW transparent">
    <!-- Logo e navegaci√≥n -->
</header>

<section class="hero-dark">
    <!-- Contenido oscuro - header se adaptar√° -->
</section>

<section class="hero-light">
    <!-- Contenido claro - header se adaptar√° -->
</section>
```

### Men√∫ Multi-nivel Complejo
```html
<nav class="siteMenuNav">
    <ul class="menu">
        <li><a href="/">Inicio</a></li>
        <li class="menu-item-has-children">
            <a href="#">Productos</a>
            <ul class="sub-menu">
                <li><a href="/productos/categoria1">Categor√≠a 1</a></li>
                <li class="menu-item-has-children">
                    <a href="/productos/categoria2">Categor√≠a 2</a>
                    <ul class="sub-menu">
                        <li><a href="/productos/subcat1">Subcategor√≠a 1</a></li>
                        <li><a href="/productos/subcat2">Subcategor√≠a 2</a></li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
</nav>
```

## üêõ Soluci√≥n de Problemas

### Problemas de Contraste

1. **Adaptaci√≥n no funciona**: Verificar elementos con clase correcta `.siteMenuW`
2. **An√°lisis incorrecto**: Revisar que elementos de texto tengan las clases esperadas
3. **Performance lento**: Reducir frecuencia de an√°lisis o simplificar selectores

### Problemas de Men√∫ M√≥vil

1. **Animaciones no funcionan**: Verificar que GSAP est√© cargado
2. **Submen√∫s no togglean**: Revisar estructura HTML correcta con `.menu-item-has-children`
3. **Burger no aparece**: Verificar media query `@media (max-width: 999px)`

### Debug
```javascript
// Habilitar an√°lisis detallado
window.gloryDebug = true;

// Verificar inicializaci√≥n
console.log('Header adaptativo:', document.querySelector('.siteMenuW').dataset.adaptiveHeaderInitialized);
console.log('Men√∫ m√≥vil:', document.querySelector('.siteMenuW').dataset.menuInitialized);

// Forzar an√°lisis manual
gloryAdaptiveHeader();
```

## üìä Performance

- **Throttling**: `requestAnimationFrame` para an√°lisis de contraste
- **Lazy initialization**: Solo se ejecuta si existen elementos requeridos
- **MutationObserver**: Monitoreo eficiente de cambios en DOM
- **Event delegation**: M√≠nimos event listeners
- **Memory safe**: Prevenci√≥n de inicializaciones m√∫ltiples

## üîÑ Compatibilidad

- ‚úÖ **Modern Browsers**: ES6+, getComputedStyle, MutationObserver
- ‚úÖ **GSAP**: Requiere GreenSock Animation Platform
- ‚úÖ **Mobile**: Touch events y responsive design
- ‚úÖ **WordPress**: Integraci√≥n completa con themes
- ‚úÖ **Progressive Enhancement**: Funciona sin JavaScript (men√∫ b√°sico)
- ‚úÖ **Accessibility**: Soporte b√°sico para navegaci√≥n por teclado
