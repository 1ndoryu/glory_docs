---
title: Sistema de Men√∫s Interactivos
description: Gestor de men√∫s de navegaci√≥n con submen√∫s hover, posicionamiento inteligente y soporte para accesibilidad
---

import { Card, CardGrid } from '@astrojs/starlight/components';

# Sistema de Men√∫s Interactivos (`menu.js`)

El sistema de men√∫s interactivos proporciona una experiencia de navegaci√≥n avanzada con submen√∫s que aparecen al hacer hover, posicionamiento inteligente absoluto, portal DOM para manejo de z-index, y soporte completo para accesibilidad por teclado. Est√° optimizado para men√∫s de navegaci√≥n principales con submen√∫s jer√°rquicos.

## üöÄ Inicio R√°pido

```html
<!-- Estructura b√°sica del men√∫ -->
<nav class="siteMenuNav">
    <ul class="menu">
        <li>
            <a href="/">Inicio</a>
        </li>
        <li>
            <a href="/productos">Productos</a>
            <ul class="sub-menu">
                <li><a href="/productos/categoria1">Categor√≠a 1</a></li>
                <li><a href="/productos/categoria2">Categor√≠a 2</a></li>
                <li>
                    <a href="/productos/submenu">Con Submen√∫</a>
                    <ul class="sub-menu">
                        <li><a href="/productos/submenu/item1">Item 1</a></li>
                        <li><a href="/productos/submenu/item2">Item 2</a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            <a href="/contacto">Contacto</a>
        </li>
    </ul>
</nav>
```

```css
/* Estilos recomendados */
.siteMenuNav {
    position: relative;
    z-index: 1000;
}

.siteMenuNav .sub-menu {
    display: none;
    position: absolute;
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    min-width: 220px;
}

.siteMenuNav li.is-open > .sub-menu {
    display: block;
}

/* Clase aplicada por el sistema */
.submenu-portal {
    /* Estilos para submen√∫s movidos al portal */
}
```

```javascript
// El sistema se inicializa autom√°ticamente
// No requiere configuraci√≥n adicional
```

## üìã Funcionalidades

### Submen√∫s con Hover Inteligente
Sistema de apertura y cierre autom√°tico basado en la posici√≥n del mouse con zonas de tolerancia.

```javascript
// Comportamiento autom√°tico:
// - Hover en item ‚Üí abrir submen√∫
// - Mouse sale del √°rea ‚Üí cerrar con delay
// - Hover en submen√∫ ‚Üí mantener abierto
// - Un solo submen√∫ abierto a la vez
```

### Posicionamiento Inteligente
C√°lculo autom√°tico de posici√≥n √≥ptima dentro del contenedor de navegaci√≥n.

```javascript
// Algoritmo de posicionamiento:
// 1. Centrar horizontalmente en el item padre
// 2. Posicionar debajo con gap de 20px
// 3. Clamp dentro de los l√≠mites del nav
// 4. Ajustar autom√°ticamente en scroll/resize
```

### Portal DOM para Z-Index
Los submen√∫s se mueven al root del nav para evitar problemas de z-index con elementos padre.

```html
<!-- Antes (submen√∫ dentro de li) -->
<li>
    <a href="#">Productos</a>
    <ul class="sub-menu">...</ul>
</li>

<!-- Durante hover (submen√∫ movido al portal) -->
<nav class="siteMenuNav">
    <li>...</li>
    <ul class="sub-menu submenu-portal" style="position: absolute; z-index: 1004;">
        ...
    </ul>
</nav>
```

### Sistema de Medici√≥n No Visible
Mide dimensiones de submen√∫s sin mostrarlos visualmente para posicionamiento preciso.

```javascript
// T√©cnica de medici√≥n:
// 1. display: block + visibility: hidden + pointer-events: none
// 2. Obtener offsetWidth/offsetHeight
// 3. Restaurar estilos originales
// 4. Calcular posici√≥n basada en medidas
```

## üé® Caracter√≠sticas Visuales

### Estados Interactivos
- **Hover**: Apertura autom√°tica con delay inteligente
- **Active**: Estados visuales durante interacciones
- **Focus**: Soporte completo para navegaci√≥n por teclado
- **Transition**: Animaciones suaves de entrada/salida

### Gesti√≥n de Capas
- **Z-index**: `1004` para submen√∫s portados
- **Stacking**: Un solo submen√∫ activo a la vez
- **Overflow**: Contenci√≥n dentro del √°rea de navegaci√≥n

### Responsive Design
- **Desktop**: Submen√∫s con hover (‚â•1000px width)
- **Mobile**: Desactivado autom√°ticamente en pantallas peque√±as
- **Touch**: Comportamiento adaptado para dispositivos t√°ctiles

### Estructura HTML Generada

```html
<nav class="siteMenuNav">
    <ul class="menu">
        <li class="is-open">
            <a href="/productos">Productos</a>
            <!-- Submen√∫ movido al portal durante hover -->
        </li>
        <li>
            <a href="/servicios">Servicios</a>
        </li>
    </ul>

    <!-- Submen√∫ portado para z-index correcto -->
    <ul class="sub-menu submenu-portal"
        style="
            position: absolute;
            left: 150px;
            top: 60px;
            z-index: 1004;
            min-width: 220px;
            display: block;
        ">
        <li><a href="/productos/cat1">Categor√≠a 1</a></li>
        <li><a href="/productos/cat2">Categor√≠a 2</a></li>
    </ul>
</nav>
```

## üîß Configuraci√≥n Avanzada

### Selectores y Estructura

#### Contenedor Principal
```html
<!-- Debe tener clase exacta -->
<nav class="siteMenuNav">
    <!-- Contenido del men√∫ -->
</nav>
```

#### Estructura de Men√∫
```html
<ul class="menu">
    <li>
        <a href="#">Item con submen√∫</a>
        <ul class="sub-menu">
            <li><a href="#">Subitem</a></li>
        </ul>
    </li>
</ul>
```

#### Clases CSS Requeridas
- **`.siteMenuNav`**: Contenedor ra√≠z del men√∫
- **`.menu`**: Lista principal del men√∫
- **`.sub-menu`**: Submen√∫s (directos hijos de `li`)

### Variables de Configuraci√≥n

#### Temporizadores
```javascript
// Configuraci√≥n interna (no modificable externamente)
const closeDelay = 260; // ms - Delay para cerrar submen√∫
const repositionDelay = 240; // ms - Delay para reposicionamiento
const gap = 20; // px - Separaci√≥n vertical del submen√∫
```

#### Breakpoints
```javascript
// Activaci√≥n solo en desktop
const desktopBreakpoint = 1000; // px
if (!window.matchMedia(`(min-width: ${desktopBreakpoint}px)`).matches) return;
```

### Estilos CSS Recomendados

```css
/* Estructura base */
.siteMenuNav {
    position: relative;
    z-index: 1000;
}

.siteMenuNav .menu {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
}

.siteMenuNav .menu > li {
    position: relative;
}

/* Submen√∫s */
.siteMenuNav .sub-menu {
    display: none;
    position: absolute;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: 4px;
    min-width: 220px;
    padding: 8px 0;
    margin: 0;
    list-style: none;
}

.siteMenuNav .sub-menu .sub-menu {
    position: absolute;
    left: 100%;
    top: 0;
}

/* Estados */
.siteMenuNav li.is-open > .sub-menu {
    display: block;
}

/* Portal styling */
.siteMenuNav .submenu-portal {
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Animaciones */
.siteMenuNav .sub-menu {
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.siteMenuNav li.is-open > .sub-menu {
    opacity: 1;
    transform: translateY(0);
}

/* Accesibilidad */
.siteMenuNav a:focus {
    outline: 2px solid #007cba;
    outline-offset: 2px;
}
```

## üìù API T√©cnica

### Funciones Principales

#### `initHoverSubmenus()`
Inicializa el sistema completo de submen√∫s con hover.

```javascript
function initHoverSubmenus() {
    // Verifica breakpoint desktop
    // Configura event listeners
    // Inicializa sistema de portal
}
```

#### `moveSubmenuToNavRoot(submenu, li)`
Mueve el submen√∫ al contenedor ra√≠z para z-index correcto.

```javascript
function moveSubmenuToNavRoot(submenu, li) {
    // Almacena referencias originales
    // Mueve al nav root
    // Aplica estilos de portal
}
```

#### `positionSubmenu(submenu, li)`
Calcula y aplica la posici√≥n √≥ptima del submen√∫.

```javascript
function positionSubmenu(submenu, li) {
    // Mide dimensiones
    // Calcula posici√≥n centrada
    // Aplica clamping
    // Establece estilos left/top
}
```

#### `measureSubmenu(submenu)`
Mide dimensiones del submen√∫ sin mostrarlo visualmente.

```javascript
function measureSubmenu(submenu) {
    // Oculta temporalmente
    // Fuerza display: block
    // Obtiene medidas
    // Restaura estilos
    return { width, height };
}
```

### Eventos y Estados

#### Estados de Items
- **`is-open`**: Clase aplicada al `li` cuando su submen√∫ est√° abierto
- **`submenu-portal`**: Clase aplicada a submen√∫s movidos al portal

#### Event Listeners
- **`mouseenter`**: Abrir submen√∫
- **`mouseleave`**: Iniciar cierre con delay
- **`focusin`**: Abrir para accesibilidad
- **`focusout`**: Cerrar cuando pierde foco
- **`mousemove`**: Seguimiento global del cursor

### Sistema de Portal DOM

#### Prop√≥sito
Resolver problemas de z-index cuando elementos padre tienen `overflow: hidden` o z-index bajos.

#### Implementaci√≥n
```javascript
// Propiedades del portal
submenu.__portalOriginalParent = submenu.parentElement;
submenu.__portalNextSibling = submenu.nextSibling;
submenu.__portalParent = nav;
submenu.__portalOwner = li;
li.__portalSubmenu = submenu;
```

#### Restauraci√≥n
```javascript
function restoreSubmenu(submenu) {
    // Mover de vuelta a posici√≥n original
    // Limpiar estilos inline
    // Eliminar referencias
}
```

## üéØ Casos de Uso

### Men√∫ de Navegaci√≥n Principal
```html
<header class="site-header">
    <nav class="siteMenuNav">
        <ul class="menu">
            <li><a href="/">Inicio</a></li>

            <li>
                <a href="/productos">Productos</a>
                <ul class="sub-menu">
                    <li><a href="/productos/electronica">Electr√≥nica</a></li>
                    <li><a href="/productos/ropa">Ropa</a></li>
                    <li><a href="/productos/hogar">Hogar</a></li>
                </ul>
            </li>

            <li>
                <a href="/servicios">Servicios</a>
                <ul class="sub-menu">
                    <li><a href="/servicios/desarrollo">Desarrollo Web</a></li>
                    <li><a href="/servicios/marketing">Marketing Digital</a></li>
                    <li>
                        <a href="/servicios/consultoria">Consultor√≠a</a></li>
                        <ul class="sub-menu">
                            <li><a href="/servicios/consultoria/estrategica">Estrat√©gica</a></li>
                            <li><a href="/servicios/consultoria/tecnica">T√©cnica</a></li>
                        </ul>
                    </li>
                </ul>
            </li>

            <li><a href="/contacto">Contacto</a></li>
        </ul>
    </nav>
</header>
```

### Men√∫ Mega con Categor√≠as
```html
<nav class="siteMenuNav">
    <ul class="menu">
        <li>
            <a href="/categorias">Categor√≠as</a>
            <ul class="sub-menu mega-menu">
                <li class="mega-column">
                    <h4>Electr√≥nica</h4>
                    <ul>
                        <li><a href="/electronica/telefonos">Tel√©fonos</a></li>
                        <li><a href="/electronica/computadoras">Computadoras</a></li>
                        <li><a href="/electronica/audio">Audio</a></li>
                    </ul>
                </li>
                <li class="mega-column">
                    <h4>Hogar</h4>
                    <ul>
                        <li><a href="/hogar/muebles">Muebles</a></li>
                        <li><a href="/hogar/decoracion">Decoraci√≥n</a></li>
                        <li><a href="/hogar/jardin">Jard√≠n</a></li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
</nav>
```

### Men√∫ Administrativo
```html
<div class="admin-menu-container">
    <nav class="siteMenuNav">
        <ul class="menu">
            <li>
                <a href="/admin">Dashboard</a>
            </li>
            <li>
                <a href="/admin/contenido">Contenido</a>
                <ul class="sub-menu">
                    <li><a href="/admin/contenido/paginas">P√°ginas</a></li>
                    <li><a href="/admin/contenido/posts">Posts</a></li>
                    <li><a href="/admin/contenido/medios">Medios</a></li>
                </ul>
            </li>
            <li>
                <a href="/admin/usuarios">Usuarios</a>
                <ul class="sub-menu">
                    <li><a href="/admin/usuarios/lista">Lista de Usuarios</a></li>
                    <li><a href="/admin/usuarios/roles">Roles y Permisos</a></li>
                    <li><a href="/admin/usuarios/logs">Logs de Actividad</a></li>
                </ul>
            </li>
        </ul>
    </nav>
</div>
```

### Men√∫ con Submen√∫s Laterales
```html
<nav class="siteMenuNav">
    <ul class="menu">
        <li>
            <a href="/productos">Productos</a>
            <ul class="sub-menu">
                <li>
                    <a href="/productos/electronica">Electr√≥nica</a>
                    <ul class="sub-menu">
                        <li><a href="/productos/electronica/telefonos">Tel√©fonos</a></li>
                        <li><a href="/productos/electronica/laptops">Laptops</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/productos/ropa">Ropa</a>
                    <ul class="sub-menu">
                        <li><a href="/productos/ropa/camisas">Camisas</a></li>
                        <li><a href="/productos/ropa/pantalones">Pantalones</a></li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
</nav>
```

```css
/* Submen√∫s laterales */
.siteMenuNav .sub-menu .sub-menu {
    left: 100%;
    top: 0;
    margin-left: 1px;
}

/* Efectos hover mejorados */
.siteMenuNav .sub-menu .sub-menu {
    opacity: 0;
    visibility: hidden;
    transform: translateX(-10px);
    transition: all 0.2s ease;
}

.siteMenuNav li:hover > .sub-menu .sub-menu {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
}
```

## üîÑ Compatibilidad

- ‚úÖ **Desktop**: Funciona en navegadores modernos con hover
- ‚úÖ **Mobile**: Desactivado autom√°ticamente en pantallas &lt;1000px
- ‚úÖ **Touch**: Compatible con dispositivos t√°ctiles (sin activaci√≥n accidental)
- ‚úÖ **Accesibilidad**: Soporte completo para teclado y lectores de pantalla
- ‚úÖ **Z-index**: Sistema de portal resuelve problemas de apilamiento
- ‚úÖ **Performance**: Event delegation y throttling para optimizaci√≥n
- ‚úÖ **Responsive**: Adaptable a diferentes tama√±os de contenedor
- ‚úÖ **Cross-browser**: Compatible con navegadores modernos

## üêõ Soluci√≥n de Problemas

### Problemas Comunes

1. **Submen√∫s no aparecen**: Verificar clase `.siteMenuNav` exacta
2. **Posicionamiento incorrecto**: Revisar CSS `position: relative` en nav
3. **Z-index insuficiente**: Verificar que nav tenga z-index base
4. **No funciona en m√≥vil**: Correcto, est√° desactivado en pantallas peque√±as
5. **Cierres prematuros**: Ajustar delays o zonas de tolerancia del mouse

### Debug Interactivo
```javascript
// Verificar inicializaci√≥n
console.log('Men√∫ inicializado para:', document.querySelector('.siteMenuNav'));

// Monitorear eventos
document.addEventListener('mouseenter', function(e) {
    if (e.target.closest('.siteMenuNav li')) {
        console.log('Hover en item de men√∫:', e.target.textContent);
    }
}, true);

// Verificar estado de submen√∫s
function verificarEstadoMenu() {
    const nav = document.querySelector('.siteMenuNav');
    const itemsAbiertos = nav.querySelectorAll('li.is-open');
    const submenusVisibles = nav.querySelectorAll('.sub-menu[style*="display: block"]');
    const portales = nav.querySelectorAll('.submenu-portal');

    console.log('Estado del men√∫:', {
        itemsAbiertos: itemsAbiertos.length,
        submenusVisibles: submenusVisibles.length,
        submenusPortados: portales.length,
        currentItem: nav.__currentItem || null
    });
}

// Inspeccionar posicionamiento
function debugPosicionamiento() {
    const portales = document.querySelectorAll('.submenu-portal');
    portales.forEach((portal, index) => {
        const rect = portal.getBoundingClientRect();
        console.log(`Portal ${index}:`, {
            left: rect.left,
            top: rect.top,
            width: rect.width,
            height: rect.height,
            zIndex: portal.style.zIndex
        });
    });
}
```

### Troubleshooting de Z-Index
```javascript
// Verificar jerarqu√≠a de z-index
function verificarZIndex() {
    const nav = document.querySelector('.siteMenuNav');
    const navZ = window.getComputedStyle(nav).zIndex;

    const portales = document.querySelectorAll('.submenu-portal');
    portales.forEach(portal => {
        const portalZ = portal.style.zIndex;
        console.log('Z-index - Nav:', navZ, 'Portal:', portalZ);
    });

    // Verificar elementos que pueden interferir
    const elementosSuperiores = [];
    let element = nav;
    while (element.parentElement) {
        element = element.parentElement;
        const z = window.getComputedStyle(element).zIndex;
        if (z !== 'auto') {
            elementosSuperiores.push({
                element: element.tagName + (element.className ? '.' + element.className : ''),
                zIndex: z
            });
        }
    }
    console.log('Elementos padre con z-index:', elementosSuperiores);
}
```

### Reset Manual
```javascript
// Limpiar estado del men√∫
function resetMenuSystem() {
    // Cerrar todos los submen√∫s
    const itemsAbiertos = document.querySelectorAll('.siteMenuNav li.is-open');
    itemsAbiertos.forEach(li => {
        li.classList.remove('is-open');
    });

    // Restaurar submen√∫s del portal
    const portales = document.querySelectorAll('.submenu-portal');
    portales.forEach(portal => {
        if (portal.__portalOriginalParent) {
            // Restaurar a posici√≥n original
            if (portal.__portalNextSibling &&
                portal.__portalNextSibling.parentNode === portal.__portalOriginalParent) {
                portal.__portalOriginalParent.insertBefore(portal, portal.__portalNextSibling);
            } else {
                portal.__portalOriginalParent.appendChild(portal);
            }

            // Limpiar estilos y referencias
            portal.classList.remove('submenu-portal');
            portal.style.cssText = '';
            delete portal.__portalOriginalParent;
            delete portal.__portalNextSibling;
            delete portal.__portalParent;
            delete portal.__portalOwner;
        }
    });

    // Limpiar referencias globales
    delete document.__menuCurrentItem;
    delete document.__menuCloseTimer;
}

// Re-inicializar
function reinicializarMenu() {
    resetMenuSystem();
    // Forzar re-ejecuci√≥n de initHoverSubmenus
    const nav = document.querySelector('.siteMenuNav');
    if (nav) {
        nav.__menuInitialized = false;
        initHoverSubmenus();
    }
}
```

### Optimizaci√≥n de Performance
```javascript
// Monitorear performance
function monitorMenuPerformance() {
    let openCount = 0;
    let closeCount = 0;

    // Contar aperturas
    document.addEventListener('mouseenter', function(e) {
        if (e.target.closest('.siteMenuNav li')) {
            openCount++;
        }
    }, true);

    // Contar cierres
    const originalClose = window.__menuCloseFunction;
    window.__menuCloseFunction = function() {
        closeCount++;
        if (originalClose) originalClose.apply(this, arguments);
    };

    // Reporte cada 5 segundos
    setInterval(() => {
        console.log(`Men√∫ stats - Opens: ${openCount}, Closes: ${closeCount}`);
        openCount = 0;
        closeCount = 0;
    }, 5000);
}
```
