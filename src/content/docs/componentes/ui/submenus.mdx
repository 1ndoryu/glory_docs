---
title: Sistema de Submen√∫s
description: Men√∫s contextuales con activaci√≥n m√∫ltiple, posicionamiento inteligente y soporte t√°ctil
---

import { Card, CardGrid } from '@astrojs/starlight/components';

# Sistema de Submen√∫s (`submenus.js`)

Sistema avanzado de men√∫s contextuales que proporciona m√∫ltiples formas de activaci√≥n, posicionamiento inteligente y soporte completo para dispositivos t√°ctiles.

## üöÄ Inicio R√°pido

```html
<!-- Bot√≥n disparador -->
<button data-submenu="mi-menu">Abrir Men√∫</button>

<!-- Men√∫ contextual -->
<div id="mi-menu" class="glory-submenu">
    <div class="submenu-item" onclick="accion1()">Acci√≥n 1</div>
    <div class="submenu-item" onclick="accion2()">Acci√≥n 2</div>
    <div class="submenu-separator"></div>
    <div class="submenu-item" onclick="accion3()">Acci√≥n 3</div>
</div>
```

```javascript
// El sistema se inicializa autom√°ticamente
// No requiere configuraci√≥n manual adicional
```

## üìã Funcionalidades

### M√©todos de Activaci√≥n
- **Clic**: Activaci√≥n est√°ndar con `data-submenu`
- **Click derecho**: Men√∫s contextuales nativos
- **Long press**: Pulsaci√≥n larga en dispositivos t√°ctiles
- **Program√°tico**: Activaci√≥n desde JavaScript

### Caracter√≠sticas Avanzadas
- **Posicionamiento Inteligente**: Se ajusta autom√°ticamente para no salirse de pantalla
- **Singleton Pattern**: Solo un men√∫ activo a la vez
- **Integraci√≥n Modal**: Compatible con sistema de fondos modales
- **Soporte T√°ctil**: Gestos espec√≠ficos para m√≥viles
- **Accesibilidad**: Navegaci√≥n por teclado y escape

## üé® Estructura HTML

### Disparador B√°sico
```html
<!-- Cualquier elemento puede ser disparador -->
<button data-submenu="menu-principal">Men√∫</button>
<a href="#" data-submenu="menu-opciones">Opciones</a>
<div data-submenu="menu-contextual">Elemento</div>
```

### Men√∫ Contextual
```html
<div id="menu-principal" class="glory-submenu">
    <div class="submenu-item" onclick="editar()">Editar</div>
    <div class="submenu-item" onclick="duplicar()">Duplicar</div>
    <div class="submenu-separator"></div>
    <div class="submenu-item danger" onclick="eliminar()">Eliminar</div>
</div>
```

### Estructura Completa
```html
<!-- Disparador con configuraci√≥n -->
<button data-submenu="menu-usuario"
        data-posicion="abajo"
        data-evento="click">
    Usuario
</button>

<!-- Men√∫ con elementos -->
<div id="menu-usuario" class="glory-submenu">
    <div class="submenu-header">Juan P√©rez</div>
    <div class="submenu-item" onclick="verPerfil()">
        <i class="icon-user"></i> Ver Perfil
    </div>
    <div class="submenu-item" onclick="configuracion()">
        <i class="icon-settings"></i> Configuraci√≥n
    </div>
    <div class="submenu-separator"></div>
    <div class="submenu-item danger" onclick="cerrarSesion()">
        <i class="icon-logout"></i> Cerrar Sesi√≥n
    </div>
</div>
```

## üîß Atributos de Configuraci√≥n

### data-submenu
ID del men√∫ a mostrar (requerido).

```html
<button data-submenu="mi-menu-id">Abrir</button>
<div id="mi-menu-id"><!-- men√∫ --></div>
```

### data-posicion
Posici√≥n del men√∫ respecto al disparador.

```html
<!-- Opciones: abajo (default), arriba, izquierda, derecha, centro -->
<button data-submenu="menu" data-posicion="derecha">Men√∫</button>
```

### data-evento
Tipo de evento que activa el men√∫.

```html
<!-- Opciones: click (default), contextmenu, longpress -->
<button data-submenu="menu" data-evento="contextmenu">Click derecho</button>
```

## üìù API T√©cnica

### Clase Principal

#### `submenus` (Singleton)
Gestiona todos los men√∫s contextuales de la p√°gina.

```javascript
// Acceso a la instancia (se crea autom√°ticamente)
const gestorMenus = submenus.iniciar();

// M√©todos disponibles
gestorMenus.abrir(disparador, opciones);
gestorMenus.cerrar();
```

### M√©todos P√∫blicos

#### `abrir(disparador, opciones)`
Abre un men√∫ espec√≠fico program√°ticamente.

```javascript
const gestor = submenus.iniciar();
const boton = document.querySelector('[data-submenu="mi-menu"]');
gestor.abrir(boton, { cursor: { x: 100, y: 200 } });
```

#### `cerrar()`
Cierra el men√∫ actualmente activo.

```javascript
const gestor = submenus.iniciar();
gestor.cerrar();
```

### Funci√≥n Global

#### `gloryCerrarSubmenus()`
Funci√≥n global para cerrar submen√∫s desde otros componentes.

```javascript
// √ötil para integraci√≥n con modales
gloryCerrarSubmenus();
```

## üéØ Posicionamiento Inteligente

### Posiciones Disponibles

#### `abajo` (predeterminado)
```javascript
// Se posiciona debajo del disparador, centrado horizontalmente
data-posicion="abajo"
```

#### `arriba`
```javascript
// Se posiciona encima del disparador
data-posicion="arriba"
```

#### `izquierda`
```javascript
// Se posiciona a la izquierda del disparador
data-posicion="izquierda"
```

#### `derecha`
```javascript
// Se posiciona a la derecha del disparador
data-posicion="derecha"
```

#### `centro`
```javascript
// Se centra en la pantalla (√∫til para m√≥viles)
data-posicion="centro"
```

### Ajustes Autom√°ticos
- **L√≠mites de pantalla**: Se reposiciona si se sale de la vista
- **Responsive**: En m√≥viles (&lt; 640px) usa centrado por defecto
- **Coordenadas exactas**: Para men√∫s contextuales con cursor

## üîÑ Eventos y Estados

### Eventos de Integraci√≥n

#### `gloryModal:open`
Cierra autom√°ticamente submen√∫s cuando se abre un modal.

```javascript
document.addEventListener('gloryModal:open', () => {
    // Los submen√∫s se cierran autom√°ticamente
});
```

#### `gloryFondo:click`
Cierra submen√∫s al hacer clic en el fondo modal.

```javascript
document.addEventListener('gloryFondo:click', () => {
    // Los submen√∫s se cierran autom√°ticamente
});
```

### Estados Visuales

#### `.activo`
Clase aplicada al men√∫ cuando est√° visible.

```css
.glory-submenu.activo {
    display: flex;
    /* otros estilos */
}
```

#### `.glory-submenu`
Clase base para estilos del men√∫.

```css
.glory-submenu {
    position: fixed;
    display: none;
    flex-direction: column;
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 1000;
}
```

## üé® Estilos CSS Recomendados

### Estilos B√°sicos
```css
.glory-submenu {
    position: fixed;
    display: none;
    flex-direction: column;
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 1000;
    min-width: 160px;
}

.glory-submenu.activo {
    display: flex;
}

.submenu-item {
    padding: 8px 16px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s;
}

.submenu-item:hover {
    background-color: #f5f5f5;
}

.submenu-item.danger {
    color: #dc3545;
}

.submenu-item.danger:hover {
    background-color: #ffebee;
}

.submenu-separator {
    height: 1px;
    background-color: #e0e0e0;
    margin: 4px 0;
}

.submenu-header {
    padding: 12px 16px 8px;
    font-weight: bold;
    border-bottom: 1px solid #e0e0e0;
    color: #666;
}
```

### Tema Oscuro
```css
/* Tema oscuro */
.glory-submenu.dark {
    background: #2d3748;
    border-color: #4a5568;
    color: white;
}

.glory-submenu.dark .submenu-item:hover {
    background-color: #4a5568;
}

.glory-submenu.dark .submenu-separator {
    background-color: #4a5568;
}

.glory-submenu.dark .submenu-header {
    border-bottom-color: #4a5568;
    color: #a0aec0;
}
```

## üì± Soporte T√°ctil

### Long Press en M√≥viles
```html
<!-- Activaci√≥n por pulsaci√≥n larga -->
<button data-submenu="menu-tactil" data-evento="longpress">
    Mant√©n pulsado
</button>
```

### Configuraci√≥n del Long Press
- **Duraci√≥n**: 500ms por defecto
- **Feedback**: Vibraci√≥n autom√°tica (si soportada)
- **Cancelaci√≥n**: Movimiento del dedo cancela la acci√≥n

### Eventos T√°ctiles
```javascript
// El sistema maneja autom√°ticamente:
// - pointerdown: Inicia temporizador
// - pointerup: Ejecuta si fue long press
// - pointermove: Cancela si se mueve el dedo
```

## üéØ Casos de Uso

### Men√∫ Contextual de Usuario
```html
<button data-submenu="user-menu" data-posicion="abajo">
    <img src="avatar.jpg" alt="Usuario">
</button>

<div id="user-menu" class="glory-submenu">
    <div class="submenu-header">Juan P√©rez</div>
    <div class="submenu-item" onclick="verPerfil()">
        üë§ Ver Perfil
    </div>
    <div class="submenu-item" onclick="configuracion()">
        ‚öôÔ∏è Configuraci√≥n
    </div>
    <div class="submenu-separator"></div>
    <div class="submenu-item danger" onclick="cerrarSesion()">
        üö™ Cerrar Sesi√≥n
    </div>
</div>
```

### Men√∫ de Acciones en Tabla
```html
<tr data-id="123">
    <td>Dato 1</td>
    <td>Dato 2</td>
    <td>
        <button data-submenu="acciones-fila-123" data-evento="click">
            ‚ãÆ
        </button>
    </td>
</tr>

<div id="acciones-fila-123" class="glory-submenu">
    <div class="submenu-item" onclick="editar(123)">Editar</div>
    <div class="submenu-item" onclick="duplicar(123)">Duplicar</div>
    <div class="submenu-item danger" onclick="eliminar(123)">Eliminar</div>
</div>
```

### Men√∫ Contextual de Escritorio
```html
<div class="archivo" data-submenu="menu-archivo" data-evento="contextmenu">
    <img src="documento.png">
    <span>Mi Documento.txt</span>
</div>

<div id="menu-archivo" class="glory-submenu">
    <div class="submenu-item" onclick="abrir()">Abrir</div>
    <div class="submenu-item" onclick="renombrar()">Renombrar</div>
    <div class="submenu-item" onclick="compartir()">Compartir</div>
    <div class="submenu-separator"></div>
    <div class="submenu-item danger" onclick="eliminar()">Eliminar</div>
</div>
```

## üîß Integraci√≥n Avanzada

### Con Sistema de Fondos
```javascript
// Los submen√∫s se integran autom√°ticamente con mostrarFondo/ocultarFondo
// Tambi√©n pueden controlarse manualmente
if (typeof window.mostrarFondo === 'function') {
    window.mostrarFondo();
}
```

### Con Modales
```javascript
// Cerrar submen√∫s antes de abrir modales
document.addEventListener('gloryModal:beforeOpen', () => {
    gloryCerrarSubmenus();
});
```

### Program√°tico
```javascript
// Abrir men√∫ desde c√≥digo
const gestor = submenus.iniciar();
const disparador = document.querySelector('[data-submenu="mi-menu"]');
gestor.abrir(disparador, {
    cursor: { x: event.clientX, y: event.clientY }
});
```

## üêõ Soluci√≥n de Problemas

### Problemas Comunes

1. **Men√∫ no aparece**: Verificar ID correcto en `data-submenu`
2. **Posicionamiento incorrecto**: Revisar `data-posicion` y espacio disponible
3. **Eventos no funcionan**: Verificar que no haya elementos superpuestos
4. **M√≥viles no responden**: Revisar configuraci√≥n de `data-evento`

### Debug
```javascript
// Verificar inicializaci√≥n
console.log('Submenus instancia:', submenus.instancia);

// Debug de eventos
document.addEventListener('click', (e) => {
    if (e.target.closest('[data-submenu]')) {
        console.log('Disparador clickeado:', e.target);
    }
});
```

## üìä Rendimiento

- **Singleton Pattern**: Una sola instancia gestiona todos los men√∫s
- **Event Delegation**: M√≠nimos event listeners globales
- **Lazy Positioning**: C√°lculo de dimensiones solo cuando es necesario
- **Memory Management**: Limpieza autom√°tica de referencias

## üîÑ Compatibilidad

- ‚úÖ **Modern Browsers**: ES6+, Pointer Events, Position Fixed
- ‚úÖ **Mobile**: Touch events y responsive positioning
- ‚úÖ **Legacy**: Funciona con polyfills para Pointer Events
- ‚úÖ **WordPress**: Integraci√≥n completa con admin UI
- ‚úÖ **Accessibility**: Soporte para navegaci√≥n por teclado
- ‚úÖ **Cross-browser**: Compatible con todos los navegadores modernos
